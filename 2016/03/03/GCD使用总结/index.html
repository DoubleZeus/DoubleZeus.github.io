<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="ZeusZhang"><title>GCDä½¿ç”¨æ€»ç»“ Â· ZeusZhang</title><meta name="description" content="###ä»€ä¹ˆæ˜¯GCDGCDå…¨ç§°ä¸ºGrand Centeral Dispatchï¼Œä¸ºiOSå’ŒOS Xçš„å¤šæ ¸ç¡¬ä»¶ä¸Šæ‰§è¡Œæä¾›æ§åˆ¶ï¼Œæ˜¯æ„ä¸æ‰§è¡Œä»»åŠ¡çš„æŠ€æœ¯ä¹‹ä¸€ã€‚å¼€å‘è€…åªéœ€è¦å®šä¹‰æƒ³æ‰§è¡Œçš„ä»»åŠ¡å¹¶è¿½åŠ åˆ°é€‚å½“çš„Dispatch Queueä¸­ï¼ŒGCDå°±èƒ½ç”Ÿæˆå¿…è¦çš„çº¿ç¨‹å¹¶æ‰§è¡Œè®¡åˆ’ä»»åŠ¡ã€‚ç”±äºçº¿ç¨‹ç®¡ç†æ˜¯ä½œä¸ºç³»ç»Ÿçš„ä¸€éƒ¨åˆ†æ¥å®ç°çš„"><meta name="keywords" content="zeus,zeuszhang,dobulez,iOS"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;"><h3 title=""><a href="/">ZeusZhang</a></h3><div class="description"><p>zeuszhang blog</p></div></div></div><ul class="social-links"></ul><div class="footer"><a target="_blank" href="/"><span>Theme by </span></a><a href="https://www.caicai.me"> CaiCai </a><span>&</span><a href="https://github.com/Ben02/hexo-theme-Anatole"> Ben</a><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Proudly published with Hexo&#65281;</a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">é¦–é¡µ</a></li><li><a href="/about">å…³äº</a></li><li><a href="/archives">å½’æ¡£</a></li><li><a href="/links">å‹é“¾</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div><div class="avatar"><img></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>GCDä½¿ç”¨æ€»ç»“</a></h3></div><div class="post-content"><p>###ä»€ä¹ˆæ˜¯GCD<br>GCDå…¨ç§°ä¸ºGrand Centeral Dispatchï¼Œä¸ºiOSå’ŒOS Xçš„å¤šæ ¸ç¡¬ä»¶ä¸Šæ‰§è¡Œæä¾›æ§åˆ¶ï¼Œæ˜¯æ„ä¸æ‰§è¡Œä»»åŠ¡çš„æŠ€æœ¯ä¹‹ä¸€ã€‚<br>å¼€å‘è€…åªéœ€è¦å®šä¹‰æƒ³æ‰§è¡Œçš„ä»»åŠ¡å¹¶è¿½åŠ åˆ°é€‚å½“çš„Dispatch Queueä¸­ï¼ŒGCDå°±èƒ½ç”Ÿæˆå¿…è¦çš„çº¿ç¨‹å¹¶æ‰§è¡Œè®¡åˆ’ä»»åŠ¡ã€‚ç”±äºçº¿ç¨‹ç®¡ç†æ˜¯ä½œä¸ºç³»ç»Ÿçš„ä¸€éƒ¨åˆ†æ¥å®ç°çš„ï¼Œå› æ­¤å¯ä»¥ç»Ÿä¸€ç®¡ç†ï¼Œä¹Ÿå¯æ‰§è¡Œä»»åŠ¡ï¼Œè¿™æ ·å°±æ¯”ä»¥å‰çš„çº¿ç¨‹æ›´æœ‰æ•ˆç‡ã€‚ä¸¾ä¸ªğŸŒ°<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">dispatch_async(queue,^&#123;</span><br><span class="line">    /*</span><br><span class="line">    * é•¿æ—¶é—´ä»»åŠ¡å¤„ç†</span><br><span class="line">    *</span><br><span class="line">    * ä¾‹å¦‚æ•°æ®åº“è®¿é—®</span><br><span class="line">    */</span><br><span class="line">    /*</span><br><span class="line">    * é•¿æ—¶é—´å¤„ç†ç»“æŸï¼Œä¸»çº¿ç¨‹ä¸­ä½¿ç”¨ç»“æœ</span><br><span class="line">    */</span><br><span class="line">    dispatch_async(dispatch_get_main_queue(),^&#123;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>ä¸Šé¢ä»£ç å°±æ˜¯åœ¨åå°æ‰§è¡Œçº¿ç¨‹ä¸­æ‰§è¡Œé•¿æ—¶é—´å¤„ç†ï¼Œå¤„ç†ç»“æŸæ—¶ï¼Œä¸»çº¿ç¨‹ä½¿ç”¨è¯¥å¤„ç†ç»“æœçš„æºä»£ç ã€‚</p>
<p>###Dispatch Queueçš„ç§ç±»<br>Dispatch queueçš„ç§ç±»æœ‰ä¸¤ç§ï¼šä¸€ç§æ˜¯ç­‰å¾…æ‰§è¡Œä¸­å¤„ç†ç»“æŸçš„<strong>Serial Dispatch Queueï¼ˆä¸²è¡Œé˜Ÿåˆ—ï¼‰</strong>ï¼Œå¦ä¸€ç§æ˜¯ä¸ç­‰å¾…æ‰§è¡Œä¸­å¤„ç†çš„<strong>Concurrent Dispatch Queueï¼ˆå¹¶è¡Œé˜Ÿåˆ—ï¼‰</strong>ã€‚<br>è™½ç„¶æœ‰äº†Queueçš„ç§ç±»ï¼Œé‚£ä¹ˆå¦‚ä½•æ‰èƒ½å¾—åˆ°Dispatch queueå‘¢ï¼Ÿ</p>
<p>####dispatch_queue_create<br>ç¬¬ä¸€ä¸­æ–¹æ³•æ˜¯é€šè¿‡GCDçš„Apiç”ŸæˆDispatch Queue<br><figure class="highlight plain"><figcaption><span>myQueue </span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">```</span><br><span class="line"></span><br><span class="line">Serial Dispatch queueå¯ä»¥åœ¨åˆ›å»ºæ—¶ç”¨NULLæ ‡è¯†ï¼›å¤šä¸ªçº¿ç¨‹æ›´æ–°ç›¸åŒèµ„æºå¯¼è‡´æ•°æ®ç«äº‰æ—¶å»ºè®®ä½¿ç”¨Serial Dispatch Queue</span><br></pre></td></tr></table></figure></p>
<p>dispatch_queue_t myQueue = dispatch_queue_create(â€œcom.zeuszhang.gcd.myQueueâ€,DISPATCH_QUEUE_CONCURRENT);<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">####Main Dispatch Queue/Global Dispatch Queue</span><br><span class="line">ç¬¬äºŒç§æ–¹æ³•æ˜¯è·å–ç³»ç»Ÿæä¾›çš„Dispatch Queue</span><br><span class="line"></span><br><span class="line">Main Dispatch Queueä¸»çº¿ç¨‹åªæœ‰ä¸€ä¸ªè‡ªç„¶æ˜¯Serial dispatch queue</span><br><span class="line">dispatch_queue_t myQueue = dispatch_get_main_queue();</span><br></pre></td></tr></table></figure></p>
<p>Global Dispatch Queueæ˜¯æ‰€æœ‰ç¨‹åºéƒ½èƒ½å¤Ÿä½¿ç”¨Concurrent dispatch queueã€‚å¦å¤–Global Dispatch queueæœ‰4ä¸ªæ‰§è¡Œä¼˜å…ˆçº§<br>1.High Priority<br>2.Default Priority<br>3.Low Priority<br>4.Background Priority<br>dispatch_queue_t myQueue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_HIGH,0);//ç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºä¼˜å…ˆçº§<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">###dispatch_set_target_queue</span><br><span class="line">dispatch_queue_createå‡½æ•°ç”Ÿæˆçš„Dispatch Queueä¸ç®¡æ˜¯Serial dispatch queueè¿˜æ˜¯Concurrent dispatch queueï¼Œéƒ½ä½¿ç”¨é»˜è®¤ä¼˜å…ˆçº§ï¼ˆdefaultï¼‰Global Dispatch queueç›¸åŒæ‰§è¡Œä¼˜å…ˆçº§çš„çº¿ç¨‹ã€‚è€Œå˜æ›´ç”Ÿæˆçš„Dispatch queueçš„ä¼˜å…ˆçº§éœ€è¦ç”¨åˆ°dispatch_set_target_queueå‡½æ•°ã€‚ğŸŒ°å¦‚ä¸‹</span><br></pre></td></tr></table></figure></p>
<p>dispatch_queue_t myQueue = dispatch_queue_create(â€œcom.zeuszhang.gcd.myQueueâ€,NULL);<br>dispatch_queue_t globalQueueBackground = dispatch_queue_create(DISPATCH_QUEUE_PRIORITY_BACKROUND,0);<br>dispatch_set_target_queue(myQueue,globalQueueBackground);<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">æŒ‡å®šå˜æ›´ä¼˜å…ˆçº§çš„Dispatch Queueä¸ºdispatch_set_target_queueå‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°ï¼ŒæŒ‡å®šè¦ä½¿ç”¨çš„æ‰§è¡Œä¼˜å…ˆçº§çš„Global dispatch queueä¸ºç¬¬äºŒä¸ªå‚æ•°ï¼›**psï¼ˆç¬¬ä¸€ä¸ªå‚æ•°ä¸å¯æŒ‡å®šä¸ºç³»ç»Ÿæä¾›çš„Main Dispatch Queueæˆ–è€…Global Dispatch Queueï¼‰**</span><br><span class="line"></span><br><span class="line">###dispatch_after</span><br><span class="line">GCDå»¶æ—¶å‡½æ•°</span><br></pre></td></tr></table></figure></p>
<p>dispatch_time_t time = dispatch_time(DISPATCH_TIME_NOW, 3ull * NSEC_PER_SEC);<br>dispatch_after(time,dispatch_get_main_queue(),^{<br>    NSLog(@â€waited at least three secondsâ€);<br>})<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">éœ€è¦æ³¨æ„çš„æ˜¯dispatch_afterå‡½æ•°å¹¶ä¸æ˜¯åœ¨æŒ‡å®šæ—¶é—´åæ‰§è¡Œå¤„ç†ï¼Œè€Œåªæ˜¯åœ¨æŒ‡å®šæ—¶é—´è¿½åŠ å¤„ç†åˆ°Dispatch Queueã€‚</span><br><span class="line"></span><br><span class="line">###Dispatch Group</span><br><span class="line">åœ¨Dispatch Queueä¸­å¤„ç†å¤šä¸ªå…¨éƒ¨ç»“æŸåæƒ³æ‰§è¡Œçš„æ“ä½œï¼Œå°±å¯ä»¥ä½¿ç”¨Dispatch Groupæ¥ä½¿ä»£ç æ›´ç®€å•</span><br></pre></td></tr></table></figure></p>
<p>dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT,0);<br>dispatch_group_t group = dispatch_group_create();<br>dispatch_group_async(group,queue,^{NSLog(@â€b1k0â€);});<br>dispatch_group_async(group,queue,^{NSLog(@â€b1k1â€);});<br>dispatch_group_async(group,queue,^{NSLog(@â€b1k2â€);});<br>dispatch_group_notify(group,dispatch_get_main_queue(),^{NSLog(@â€dineâ€);});<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">åœ¨dispatch_group_notifyå‡½æ•°ä¸­ä¸ç®¡åˆ¶å®šä»€ä¹ˆæ ·çš„Dispatch Queueï¼Œå±äºDispatch Groupçš„å…¨éƒ¨å¤„ç†å†è¿½åŠ åˆ¶å®šçš„Blockæ—¶éƒ½å·²ç»æ‰§è¡Œç»“æŸã€‚å¦å¤–ï¼Œåœ¨Dispatch Groupä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨dispatch_group_waitå‡½æ•°ä»…ç­‰å¾…å…¨éƒ¨å¤„ç†æ‰§è¡Œç»“æŸã€‚</span><br></pre></td></tr></table></figure></p>
<p>dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT,0);<br>dispatch_group_t group = dispatch_group_create();<br>dispatch_group_async(group,queue,^{NSLog(@â€b1k0â€);});<br>dispatch_group_async(group,queue,^{NSLog(@â€b1k1â€);});<br>dispatch_group_async(group,queue,^{NSLog(@â€b1k2â€);});<br>dispatch_group_wait(group,DISPATCH_TIME_FORVER);<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dispatch_group_waitå‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šä¸ºç­‰å¾…æ—¶é—´å±äºdispatch_time_tç±»å‹çš„å€¼</span><br></pre></td></tr></table></figure></p>
<p>dispatch_time_t time = dispatch_time(DISPATCH_TIME_NOW, 1ull * NSEC_PER_SEC);<br>long result - dispatch_group_wait(group,time);<br>if (result == 0) {<br>    //groupçš„å¤„ç†å…¨éƒ¨ç»“æŸ<br>} else {<br>    //groupå¤„ç†ä¸­<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">å¦‚æœdispatch_group_waitçš„è¿”å›å€¼ä¸ä¸º0ï¼Œå°±æ„å‘³ç€è™½ç„¶è¿‡äº†æŒ‡å®šçš„æ—¶é—´ï¼Œä½†groupä¸­è¿˜æœ‰å¤„ç†æ²¡æœ‰ç»“æŸï¼›è‹¥ä¸º0ï¼Œåˆ™å…¨éƒ¨å¤„ç†æ‰§è¡Œå®Œæ¯•ã€‚å½“ç­‰å¾…æ—¶é—´ä¸ºDISPATCH_TIME_FOREVER,ç”±groupçš„å¤„ç†å¿…å®šå…¨éƒ¨ç»“æŸã€‚</span><br><span class="line"></span><br><span class="line">###dispatch_barrier_async</span><br><span class="line">åœ¨è®¿é—®æ•°æ®åº“æ—¶ï¼Œå‰é¢è¯´ç”¨Serial dispatch queueå¯ä»¥é¿å…æ•°æ®ç«äº‰ã€‚å†™å…¥ä¸å¯ä»¥ä¸è¯»å–å¤„ç†å¹¶è¡Œæ“ä½œï¼Œä½†æ˜¯å¦‚æœæ˜¯è¯»å†™ä¸è¯»å†™æ˜¯å¯ä»¥å¹¶è¡Œçš„ã€‚</span><br><span class="line">ä¹Ÿå°±æ˜¯ä¸ºäº†é«˜æ•ˆè®¿é—®ï¼Œè¯»å–å¤„ç†è¿½åŠ åˆ°Concurrent dispatch queueä¸­ï¼Œå†™å…¥å¤„ç†åœ¨ä»»ä¸€ä¸ªè¯»å–å¤„ç†æ²¡æœ‰æ‰§è¡Œçš„çŠ¶æ€ä¸‹è¿½åŠ åˆ°Serial dispatch queueä¸­å³å¯ã€‚è™½ç„¶ç”¨groupæœˆdispatch_set_target_queueä¹Ÿå¯ä»¥å¤„ç†ï¼Œä½†ä»£ç é€»è¾‘å¤æ‚ï¼Œè¿™é‡Œæä¾›ä¸€ä¸ªç®€å•æ–¹æ³•**dispatch_barrier_async**</span><br><span class="line">ğŸŒ°ï¼š</span><br></pre></td></tr></table></figure></p>
<p>é¦–å…ˆç”Ÿæˆä¸€ä¸ªConcurrent dispatch queueåœ¨queueä¸­è¿½åŠ è¯»å–å¤„ç†<br>dispatch_queue_t queue = dispatch_queue_create(â€œcom.zueszhang.gcd.forBarrierâ€,DISPATCH_QUEUE_CONCURRENT);<br>dispatch_async(queue,b1k0_fro_reading);<br>dispatch_async(queue,b1k1_fro_reading);<br>dispatch_async(queue,b1k2_fro_reading);<br>dispatch_async(queue,b1k3_fro_reading);<br>dispatch_barrier_async(b1k_for_writing);<br>dispatch_async(queue,b1k4_fro_reading);<br>dispatch_async(queue,b1k5_fro_reading);<br>dispatch_async(queue,b1k6_fro_reading);<br>dispatch_async(queue,b1k7_fro_reading);<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">###dispatch_sync</span><br><span class="line">dispatch_syncå°±æ˜¯å°†æŒ‡å®šçš„block***åŒæ­¥***çš„è¿½åŠ åˆ°æŒ‡å®šçš„Dispatch Queueä¸­ï¼Œå†è¿½åŠ Blockç»“æŸä¹‹å‰ï¼Œdispatch_syncå‡½æ•°ä¼šä¸€ç›´ç­‰å¾…ã€‚</span><br><span class="line"></span><br><span class="line">###dispatch_apply</span><br><span class="line">dispatch_applyå‡½æ•°æ˜¯å°†dispatch_syncå’ŒDispatch Groupå…³è”çš„apiã€‚è¯¥å‡½æ•°æŒ‰æŒ‡å®šçš„æ¬¡æ•°å°†æŒ‡å®šçš„Blockè¿½åŠ åˆ°æŒ‡å®šçš„Dispatch Queueä¸­ï¼Œå¹¶ç­‰å¾…å…¨éƒ¨å¤„ç†ç»“æŸ</span><br><span class="line">ğŸŒ°</span><br></pre></td></tr></table></figure></p>
<p>dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT,0);<br>dispatch_apply(10,queue,^(size_t index) {<br>    NSLog(@â€%zuâ€,index)<br>})<br>NSLog(@â€Doneâ€);<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">å› ä¸ºåœ¨Global Dispatch queueä¸­å¤„ç†æ‰€ä»¥çº¿ç¨‹ï¼Œæ‰€ä»¥å„ä¸ªæ“ä½œæ—¶é—´ä¸å®šã€‚ä½†æ˜¯Doneè‚¯å®šæ˜¯åœ¨æœ€åè¢«è¾“å‡ºã€‚</span><br><span class="line">ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºé‡å¤æ¬¡æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯è¿½åŠ å¯¹è±¡çš„Dispatch Queueï¼Œç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºè¿½åŠ çš„blockå¤„ç†ã€‚</span><br><span class="line">å¸¸ç”¨ä½œä¸å¯¹æ•°ç»„ç±»å¯¹è±¡çš„æ‰€æœ‰å…ƒç´ æ‰§è¡Œå¤„ç†æ—¶ï¼Œå¯ä»¥æ›¿ä»£forå¾ªç¯çš„æ•ˆæœã€‚</span><br><span class="line">å¦å¤–ï¼Œç”±äºdispatch_applyå‡½æ•°ä¹Ÿä¸dispatch_syncå‡½æ•°ç›¸åŒï¼Œä¼šç­‰å¾…å¤„ç†æ‰§è¡Œç»“æŸï¼Œå› æ­¤æ¨èåœ¨dispatch_asyncå‡½æ•°ä¸­éåŒæ­¥çš„æ‰§è¡Œdispatch_apply</span><br></pre></td></tr></table></figure></p>
<p>dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT,0);<br>//åœ¨global dipsatch queueä¸­éåŒæ­¥æ‰§è¡Œ<br>dispatch_async(queue,^{<br>    //ç­‰å¾…dispatch_applyå‡½æ•°ä¸­å…¨éƒ¨å¤„ç†ç»“æŸ<br>    dispatch_apply([array count],queue,^(size_t index){<br>        //å¹¶åˆ—å¤„ç†åŒ…å«åœ¨arrayä¸­çš„å…¨éƒ¨å¯¹è±¡<br>        NSLog(@â€%zu:%@â€,index,[array objectAtIndex:index]);<br>    });<br>    //ç­‰å¾…å®Œæ¯•ååœ¨mainä¸­æ‰§è¡Œå¤„ç†<br>    dispatch_async(dispatch_get_main_queue(),^{<br>        NSLog(@â€Doneâ€);<br>    });<br>});<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">###dispatch_suspend / dispatch_resume</span><br><span class="line">å½“è¿½åŠ å¤§é‡å¤„ç†åˆ°Disaptch Queueæ—¶ï¼Œå†è¿½åŠ å¤„ç†çš„è¿‡ç¨‹ä¸­ï¼Œæœ‰æ—¶å¸Œæœ›ä¸æ‰§è¡Œå·²è¿½åŠ çš„å¤„ç†ã€‚ä¾‹å¦‚æ¼”ç®—ç»“æœè¢«blockæˆªè·æ—¶ï¼Œä¸€äº›å¤„ç†ä¼šå¯¹è¿™ä¸ªç»“æœé€ æˆå½±å“ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œåªè¦æŒ‚èµ·Dispatch Queueå³å¯ï¼Œå½“å¯æ‰§è¡Œæ—¶å†æ¢å¤ã€‚</span><br><span class="line"></span><br><span class="line">###Dispatch Semaphore</span><br><span class="line">å½“å¹¶è¡Œæ‰§è¡Œçš„å¤„ç†æ›´æ–°æ•°æ®æ—¶ï¼Œä¼šäº§ç”Ÿæ•°æ®ç«äº‰çš„å¯èƒ½ï¼Œæœ‰æ—¶è¿˜ä¼šå¯¼è‡´ç¨‹åºå¼‚å¸¸ã€‚è™½ç„¶é€šè¿‡Serial Dispatch Queueå’Œdispatch_barrier_asyncå‡½æ•°å¯ä»¥é¿å…è¿™ç±»é—®é¢˜ï¼Œä½†æ˜¯æœ‰å¿…è¦æ›´ç»†åŠ›åº¦çš„æ§åˆ¶å®ƒã€‚</span><br><span class="line">ğŸŒ°ï¼šä¸è€ƒè™‘æ’åºï¼Œå°†æ‰€æœ‰æ•°æ®è¿½åŠ åˆ°NSMutableArrayä¸­ã€‚</span><br></pre></td></tr></table></figure></p>
<p>dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT,0);<br>NSMutableArray *array = [[NSMutableArray alloc] init];<br>for (int i = 0; i &lt; 10000; i++) {<br>    dispatch_async(queue,^{<br>        [array addObject:[NSNumber numberWithInt:i]];<br>    });<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">æ­¤æ—¶ï¼Œä½¿ç”¨globalæ›´æ–°NSMutableArrayå¯¹è±¡ï¼Œæ‰€ä»¥æ‰§è¡Œåç”±å†…å­˜é”™è¯¯å¯¼è‡´ç¨‹åºå¼‚å¸¸ç»“æŸæ¦‚ç‡å¾ˆé«˜ã€‚æ­¤æ—¶åº”è¯¥ä½¿ç”¨Dispatch Semaphoreã€‚</span><br><span class="line">Dispatch Semaphoreæ˜¯æŒæœ‰è®¡æ•°çš„ä¿¡å·ï¼Œè¯¥è®¡æ•°æ˜¯å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­çš„è®¡æ•°ç±»å‹ä¿¡å·ã€‚åœ¨Dispatch Semaphoreä¸­ï¼Œè®¡æ•°ä¸º0æ—¶ç­‰å¾…ï¼Œè®¡æ•°ä¸º1æˆ–å¤§äº1æ—¶ï¼Œå‡å»1è€Œä¸ç­‰å¾…ã€‚</span><br></pre></td></tr></table></figure></p>
<p>dispatch_semaphore_t semaphore = dispatch_semaphore_create(1);<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å‚æ•°è¡¨ç¤ºè®¡æ•°çš„åˆå§‹å€¼ã€‚ä»å‡½æ•°åˆ›å»ºåç§°ä¸­createå¯ä»¥çœ‹å‡ºï¼Œè¯¥å‡½æ•°ä¸Dispatch Queueå’ŒDispatch Groupä¸€æ ·ï¼Œå¿…é¡»é€šè¿‡dispatch_releaseå‡½æ•°é‡Šæ”¾ã€‚</span><br><span class="line">dispatch_semaphore_waitå‡½æ•°ç­‰å¾…Dispatch Semaphoreçš„è®¡æ•°å€¼è¾¾åˆ°å¤§äºæˆ–ç­‰äº1ã€‚å½“è®¡æ•°å€¼å¤§äºç­‰äº1ï¼Œæˆ–è€…åœ¨å¾…æœºä¸­è®¡æ•°å€¼å¤§äºç­‰äº1æ—¶ï¼Œå¯¹è¯¥è®¡æ•°è¿›è¡Œå‡æ³•å¹¶ä»dispatch_semaphore_waitå‡½æ•°è¿”å›ã€‚ç¬¬äºŒä¸ªå‚æ•°ä¸dispatch_group_waitå‡½æ•°ç­‰ç›¸åŒï¼Œç”±dispatch_time_tç±»å‹å€¼æŒ‡å®šç­‰å¾…æ—¶é—´ã€‚</span><br><span class="line">ğŸŒ°ï¼š</span><br></pre></td></tr></table></figure></p>
<p>dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT,0);<br>dispatch_semaphore_t semaphore = dispatch_semaphore_create(1);<br>NSMutableArray *array = [[NSMutableArray alloc] init];<br>for (int i = 0; i &lt; 10000; ++i) {<br>    dispatch_async(queue,^{<br>        dispatch_semaphore_wait(semaphore,DISPATCH_TIME_FOREVER);<br>        [array addObject:[NSNumber numberWithInt:i]];<br>        dispatch_semaphore_signal(semaphore);<br>    })<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">###dispatch_once</span><br><span class="line">è¿™ä¸ªåº”è¯¥æ˜¯æœ€å¸¸ç”¨çš„GCD apiäº†ã€‚è¯¥å‡½æ•°æ˜¯ä¿è¯åœ¨åº”ç”¨ç¨‹åºä¸­æ‰§è¡Œä¸€æ¬¡æŒ‡å®šå¤„ç†çš„Apiã€‚</span><br><span class="line">iOSå•ä¾‹æ¨¡å¼ï¼š</span><br></pre></td></tr></table></figure></p>
<p>static id manager = nil;<br>-(id)defaultManager {<br>    static dispatch_once_t once;<br>    dispatch_once(&amp;once,^{<br>        manager = [[self alloc] init];<br>    });<br>    return manager;<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">###Dispatch I/O</span><br><span class="line">è¯»å–è¾ƒå¤§æ–‡ä»¶æ—¶ï¼Œå¦‚æœå°†æ–‡ä»¶åˆ†æˆåˆé€‚çš„å¤§å°å¹¶ä½¿ç”¨Global Dispatch Queueå¹¶åˆ—è¯»å–çš„è¯ï¼Œåº”è¯¥ä¼šæ¯”ä¸€èˆ¬çš„è¯»å–é€Ÿåº¦å¿«ä¸å°‘ã€‚ç°ä»Šçš„è¾“å…¥/è¾“å‡ºç¡¬ä»¶å·²ç»å¯ä»¥åšåˆ°ä¸€æ¬¡ä½¿ç”¨å¤šä¸ªçº¿ç¨‹æ›´å¿«çš„å¹¶åˆ—è¯»å–äº†ã€‚èƒ½å®ç°è¿™ä¸€åŠŸèƒ½çš„å°±æ˜¯Dispatch I/Oå’ŒDispatch Dataé€šè¿‡Dispatch I/Oè¯»å†™æ–‡ä»¶æ—¶ï¼Œä½¿ç”¨Global Dispatch Queueå°†1ä¸ªæ–‡ä»¶æŒ‰æŸä¸ªå¤§å°read/write</span><br></pre></td></tr></table></figure></p>
<p>disaptch_async(queue,^{/<em>è¯»å–  0 ~ 800å­—èŠ‚</em>/});<br>disaptch_async(queue,^{/<em>è¯»å–  801 ~ 1600å­—èŠ‚</em>/});<br>disaptch_async(queue,^{/<em>è¯»å–  1601 ~ 2400å­—èŠ‚</em>/});<br>disaptch_async(queue,^{/<em>è¯»å–  2401 ~ end</em>/});<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">åƒä¸Šé¢è¿™æ ·ï¼Œå°†æ–‡ä»¶åˆ†å‰²ä¸ºä¸€å—ä¸€å—çš„è¿›è¡Œè¯»å–å¤„ç†ã€‚åˆ†å‰²è¯»å–çš„æ•°æ®é€šè¿‡ä½¿ç”¨Dispatch Dataå¯è¿›è¡Œæ›´ä¸ºç®€å•çš„è¿›è¡Œç»“åˆå’Œåˆ†å‰²</span><br><span class="line">ğŸŒ°ï¼š</span><br></pre></td></tr></table></figure></p>
<p>pipe_q = dispatch_queue_create(â€œPipeQâ€,NULL);<br>pipe_channel = dispatch_io_create(DISPATCH_IO_STREAM,fd,pipe_q,^(int err) {<br>    close(fd);<br>})</p>
<p><em>out_fd = fdpair[1];<br>dispatch_io_set_low_water(pipe_channel,SIZE_MAX);<br>dispatch_id_read(pipe_channel, 0, SIZE_MAX, pipe_q,^(bool done,     dispatch_data_t pipedata, int err) {<br>    if (err == 0) {<br>        size_t len = dispatch_data_get_size(pipedata);<br>        if (len &gt; 0) {<br>            const char </em>bytes = NULL;<br>            char <em>encoded;<br>            dispatch_data_t md = dispatch_data_create_map(pipedata,(const void <strong>)&amp;bytes, &amp;len);<br>            encoded -asl_core_encode_buffer(bytes,len);<br>            asl_set((aslmsg)merged_msg,ASL_KEY_AUX_DATA,encoded);<br>            free(encoded);<br>            _asl_send_message(NULL,merged_msg,-1,NULL);<br>            asl_msg_release(merged_msg);<br>            dispatch_release(md);<br>        }<br>    }<br>    if (done) {<br>        dispatch_semphore_signal(sem);<br>        dispatch_release(pipe_channel);<br>        dispatch_release(pipe_q);<br>    }<br>});<br><code>`</code>
</strong></em>åŒæ ·ä½¿ç”¨â€createâ€ç”Ÿæˆçš„å¯¹è±¡æœ€åéƒ½è¦é‡Šæ”¾ã€‚***</p>
<p>###Disaptch Source<br>GCDä¸­é™¤äº†ä¸»è¦çš„Dispatch Queueå¤–ï¼Œè¿˜æœ‰ä¸å¤ªå¼•äººæ³¨ç›®çš„Dispatch Sourceã€‚ä»–æ˜¯BSDç³»å†…æ ¸æƒ¯æœ‰åŠŸèƒ½kqueueçš„åŒ…è£…ã€‚<br>kqueueæ˜¯åœ¨XNUå†…æ ¸ä¸­å‘ç”Ÿå„ç§äº‹ä»¶æ—¶ï¼Œåœ¨åº”ç”¨ç¨‹åºç¼–ç¨‹æ–¹æ‰§è¡Œå¤„ç†çš„æŠ€æœ¯(psä¸é‡è¦)ã€‚å®ƒçš„CPUè´Ÿè·éå¸¸å°ï¼Œå°½é‡ä¸å ç”¨èµ„æºã€‚<br>Dispatch Sourceç§ç±»</p>
<table>
<thead>
<tr>
<th>åç§°</th>
<th style="text-align:center">ç§ç±»</th>
</tr>
</thead>
<tbody>
<tr>
<td>DISPATCH_SOURCE_TYPE_DATA_ADD</td>
<td style="text-align:center">å˜é‡å¢åŠ </td>
</tr>
<tr>
<td>DISPATCH_SOURCE_TYPE_DATA_OR</td>
<td style="text-align:center">å˜é‡OR</td>
</tr>
<tr>
<td>DISPATCH_SOURCE_TYPE_MACH_SEND</td>
<td style="text-align:center">ç«¯å£å‘é€</td>
</tr>
<tr>
<td>DISPATCH_SOURCE_TYPE_MACH_RECV</td>
<td style="text-align:center">ç«¯å£æ¥æ”¶</td>
</tr>
<tr>
<td>DISPATCH_SOURCE_TYPE_PROC</td>
<td style="text-align:center">æ£€æµ‹åˆ°ä¸è¿›ç¨‹æœ‰å…³çš„äº‹ä»¶</td>
</tr>
<tr>
<td>DISPATCH_SOURCE_TYPE_READ</td>
<td style="text-align:center">å¯è¯»å–æ–‡ä»¶æ˜ åƒ</td>
</tr>
<tr>
<td>DISPATCH_SOURCE_TYPE_SIGNAL</td>
<td style="text-align:center">æ¥æ”¶ä¿¡å·</td>
</tr>
<tr>
<td>DISPATCH_SOURCE_TYPE_TIMER</td>
<td style="text-align:center">å®šæ—¶å™¨</td>
</tr>
<tr>
<td>DISPATCH_SOURCE_TYPE_VNODE</td>
<td style="text-align:center">æ–‡ä»¶ç³»ç»Ÿå˜æ›´</td>
</tr>
<tr>
<td>DISPATCH_SOURCE_TYPE_WRITE</td>
<td style="text-align:center">å¯å†™å…¥æ˜ åƒ</td>
</tr>
</tbody>
</table>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2016-03-03</span><i class="fa fa-tag"></i></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" href="http://twitter.com/home?status=,http://yoursite.com/2016/03/03/GCDä½¿ç”¨æ€»ç»“/,ZeusZhang,GCDä½¿ç”¨æ€»ç»“,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2016/04/08/Cocoapodsé™æ€åº“æ•´ç†/" title="Cocoapodsé™æ€åº“æ•´ç†">ä¸Šä¸€ç¯‡</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2016/01/21/iOSå®šæ—¶å™¨æ•´ç†å¯¹æ¯”/" title="iOSå®šæ—¶å™¨æ•´ç†å¯¹æ¯”">ä¸‹ä¸€ç¯‡</a></li></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>