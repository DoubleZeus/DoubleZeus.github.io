<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="baidu-site-verification" content="L6Lm9d5Crl"/>
  
  
  
  
  <title>ZeusZhang</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="zeuszhang blog">
<meta name="keywords" content="zeus,zeuszhang,dobulez,iOS">
<meta property="og:type" content="website">
<meta property="og:title" content="ZeusZhang">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="ZeusZhang">
<meta property="og:description" content="zeuszhang blog">
<meta property="og:locale" content="Objective-C,Swift,JavaScript">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ZeusZhang">
<meta name="twitter:description" content="zeuszhang blog">
  
    <link rel="alternative" href="/atom.xml" title="ZeusZhang" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/favicon.png">
  
  
  <link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css">
  
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  
    
    
  
  
      <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  
  <!-- åŠ è½½ç‰¹æ•ˆ -->
    <script src="/js/pace.js"></script>
    <link href="/css/pace/pace-theme-flash.css" rel="stylesheet" />
  <script>
      var yiliaConfig = {
          fancybox: true,
          animate: true,
          isHome: true,
          isPost: false,
          isArchive: false,
          isTag: false,
          isCategory: false,
          open_in_new: false
      }
  </script>
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        
<script src="https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>

        <a href="/" class="profilepic">
            
            <img lazy-src="/img/avatar.png" class="js-avatar">
            
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">ZeusZhang</a></h1>
        </hgroup>
        
        <p class="header-subtitle">zeuszhang blog</p>
        
        
            <form>
                <input type="text" class="st-default-search-input search" id="local-search-input" placeholder="æœç´¢ä¸€ä¸‹" autocomplete="off">
            </form>
            <div id="local-search-result"></div>
        
        
            <script type="text/javascript">
                (function() {
                    'use strict';
                    function getMatchData(keyword, data) {
                        var matchData = [];
                        for(var i =0;i<data.length;i++){
                            if(data[i].title.toLowerCase().indexOf(keyword)>=0) 
                                matchData.push(data[i])
                        }
                        return matchData;
                    }
                    var $input = $('#local-search-input');
                    var $resultContent = $('#local-search-result');
                    $input.keyup(function(){
                        $.ajax({
                            url: '/search.json',
                            dataType: "json",
                            success: function( json ) {
                                var str='<ul class=\"search-result-list\">';                
                                var keyword = $input.val().trim().toLowerCase();
                                $resultContent.innerHTML = "";
                                if ($input.val().trim().length <= 0) {
                                    $resultContent.empty();
                                    $('#switch-area').show();
                                    return;
                                }
                                var results = getMatchData(keyword, json);
                                if(results.length === 0){
                                    $resultContent.empty();
                                    $('#switch-area').show();
                                    return;
                                } 
                                for(var i =0; i<results.length; i++){
                                    str += "<li><a href='"+ results[i].url +"' class='search-result-title'>"+ results[i].title +"</a></li>";
                                }
                                str += "</ul>";
                                $resultContent.empty();
                                $resultContent.append(str);
                                $('#switch-area').hide();
                            }
                        });
                    });
                })();
            </script>
        
        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>èœå•</li>
                        <li>æ ‡ç­¾</li>
                        
                        <li>å‹æƒ…é“¾æ¥</li>
                        
                        
                        <li>å…³äºæˆ‘</li>
                        
                    </ul>
                </div>
            </div>
        
        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a  href="/archives/">æ‰€æœ‰æ–‡ç« </a></li>
                        
                            <li><a  href="/categories/å¼€å‘å·¥å…·/">ç©è½¬å¼€å‘å·¥å…·</a></li>
                        
                            <li><a  href="/categories/digital">ç©è½¬æ•°ç </a></li>
                        
                            <li><a  href="/categories/algorithm">ç®—æ³•å­¦ä¹ </a></li>
                        
                            <li><a  href="/about/">å…³äºæˆ‘</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fl github"  target="_blank" href="/xxxxx" title="github">github</a>
                            
                                <a class="fl weibo"  target="_blank" href="/xxxxxxxx" title="weibo">weibo</a>
                            
                                <a class="fl rss"  target="_blank" href="/atom.xml" title="rss">rss</a>
                            
                        </ul>
                    </nav>
                </section>
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        
                    </div>
                </section>
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a target="_blank"  class="main-nav-link switch-friends-link" href="http://blog.csdn.net/baidu_21483933">csdn</a>
                    
                      <a target="_blank"  class="main-nav-link switch-friends-link" href="https://segmentfault.com/blog/maocg_web">segmentfault</a>
                    
                      <a target="_blank"  class="main-nav-link switch-friends-link" href="http://www.jianshu.com/users/eb37ef89c746/latest_articles">ç®€ä¹¦</a>
                    
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">çˆ±åŠ¨æ¼«,çˆ±æ¸¸æˆ,çˆ±ç¼–ç¨‹,çˆ±è¿åŠ¨,çˆ±çš„å¤ªå¤šäº†!</div>
                </section>
                
            </div>
        </div>
    </header>
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="å›åˆ°ä¸»é¡µ">ZeusZhang</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                
                    <img lazy-src="/img/avatar.png" class="js-avatar">
                
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="å›åˆ°ä¸»é¡µ">ZeusZhang</a></h1>
            </hgroup>
            
            <p class="header-subtitle">zeuszhang blog</p>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/archives/">æ‰€æœ‰æ–‡ç« </a></li>
                
                    <li><a href="/categories/å¼€å‘å·¥å…·/">ç©è½¬å¼€å‘å·¥å…·</a></li>
                
                    <li><a href="/categories/digital">ç©è½¬æ•°ç </a></li>
                
                    <li><a href="/categories/algorithm">ç®—æ³•å­¦ä¹ </a></li>
                
                    <li><a href="/about/">å…³äºæˆ‘</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                <div class="social">
                    
                        <a class="github" target="_blank" href="/xxxxx" title="github">github</a>
                    
                        <a class="weibo" target="_blank" href="/xxxxxxxx" title="weibo">weibo</a>
                    
                        <a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
                    
                </div>
            </nav>
        </header>
    </div>
</nav>
      <div class="body-wrap">
  
    <article id="post-Category-NSInvocationé€šä¿¡æ–¹æ¡ˆ" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a  href="/2016/08/13/Category-NSInvocationé€šä¿¡æ–¹æ¡ˆ/" class="article-date">
      <time datetime="2016-08-12T16:00:00.000Z" itemprop="datePublished">2016-08-13</time>
</a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a  class="article-title" href="/2016/08/13/Category-NSInvocationé€šä¿¡æ–¹æ¡ˆ/">Category+NSInvocationé€šä¿¡æ–¹æ¡ˆ(CTMediator)</a>
    </h1>
  


      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h3 id="Category"><a href="#Category" class="headerlink" title="Category"></a>Category</h3><p>Categoryä½œä¸ºiOSå¼€å‘è€…è‚¯å®šä¸é™Œç”Ÿï¼Œå®ƒçš„ä¸»è¦ä½œç”¨å°±æ˜¯ä¸æ”¹å˜åŸæœ‰ç±»çš„å‰æä¸‹ï¼ŒåŠ¨æ€çš„ç»™è¿™ä¸ªç±»æ·»åŠ ä¸€äº›æ–¹æ³•ã€‚Categoryè¿˜æœ‰å¾ˆå¤šæœ‰ç‚¹ï¼Œè¯¦æƒ…è¯·å‚è€ƒ<a href="https://developer.apple.com/library/archive/documentation/General/Conceptual/DevPedia-CocoaCore/Category.html#//apple_ref/doc/uid/TP40008195-CH5-SW1" target="_blank" rel="noopener">category</a></p>
<h4 id="Categoryé‡åæ–¹æ³•"><a href="#Categoryé‡åæ–¹æ³•" class="headerlink" title="Categoryé‡åæ–¹æ³•"></a>Categoryé‡åæ–¹æ³•</h4><p>Categoryåœ¨ç¼–è¯‘å™¨ä¼šç”Ÿæˆclassçš„å®ä¾‹æ–¹æ³•åˆ—è¡¨ methodLists å’Œå±æ€§åˆ—è¡¨ propertiesï¼Œè¿™ä¸¤è€…è·ŸclassåŒºåˆ«å°±æ˜¯åœ¨å‘½åè§„åˆ™éµå¾ªäº†å…¬å…±å‰ç¼€+ç±»å+categoryåå­—çš„å‘½åæ–¹å¼ï¼›ç„¶åä¼šç”Ÿæˆåˆå§‹åŒ–è‡ªèº«çš„æ–¹æ³•<code>OBJC$_CATEGORYClass$_category</code>ï¼›æœ€åï¼Œç¼–è¯‘å™¨åœ¨DATAæ®µä¸‹çš„objc_catlist sectioné‡Œä¿å­˜ä¸€ä¸ªå¤§å°ä¸º1çš„category_çš„æ•°ç»„ï¼ˆpså¤šä¸ªcategoryï¼Œä¼šç”Ÿæˆå¯¹åº”çš„é•¿åº¦ï¼‰ï¼Œç”¨äºè¿è¡ŒæœŸçš„categoryåŠ è½½ã€‚<br>å½“é‡åæ–¹æ³•å®ç°æ—¶ï¼Œå°±çœ‹è°æœ€åè¢«åŠ å…¥åˆ°methodListsä¸­ï¼Œåé¢çš„ä¼šè¦†ç›–å‰é¢çš„æ–¹æ³•ï¼Œæƒ³è¦æ›´æ”¹æ‰§è¡Œé¡ºåºå¯ä»¥åœ¨<code>Target-&gt;Build Phases-&gt;Compile Sources</code>æ›´æ”¹å¯¹åº”çš„categoryçš„é¡ºåº</p>
<h4 id="Categoryå…³è”å¯¹è±¡"><a href="#Categoryå…³è”å¯¹è±¡" class="headerlink" title="Categoryå…³è”å¯¹è±¡"></a>Categoryå…³è”å¯¹è±¡</h4><p>æˆ‘ä»¬çŸ¥é“åœ¨categoryé‡Œé¢æ— æ³•æ·»åŠ å®ä¾‹å˜é‡ã€‚ä½†æ˜¯å¾ˆå¤šæ—¶å€™éœ€è¦åœ¨categoryä¸­æ·»åŠ å’Œå¯¹è±¡å…³è”çš„å€¼ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥é€šè¿‡å…³è”å¯¹è±¡æ¥å®ç°<br>MyClass+Category.h<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;MyClass.h&quot;</span><br><span class="line"></span><br><span class="line">@interface MyClass (Category)</span><br><span class="line"></span><br><span class="line">@property(nonatomic, copy) NSString *name;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure></p>
<p>MyClass+Category.m<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;Myclass+Category.h&quot;</span><br><span class="line">#import &lt;objc/runtime.h&gt;</span><br><span class="line"></span><br><span class="line">@implementation MyClass (Category)</span><br><span class="line"></span><br><span class="line">+ (void)load &#123;</span><br><span class="line">    NSLog (@&quot;%@&quot;,@&quot;load in Category&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)setName:(NSString *)name &#123;</span><br><span class="line">    objc_setAssociatedObject(self,&quot;name&quot;,name,OBJC_ASSOCIATION_COPY);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (NSString *)name &#123;</span><br><span class="line">    NSString *nameObject = objc_getAssociatedObject(self,&quot;name&quot;);</span><br><span class="line">    return nameObject;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure></p>
<p>ä»¥ä¸Šå°±æ˜¯é€šè¿‡å…³è”å¯¹è±¡å®ç°ç»™Categoryæ·»åŠ å±æ€§ï¼Œæ–°çš„é—®é¢˜å…³è”å¯¹è±¡çš„å­˜å‚¨ï¼Œå¯¹è±¡é”€æ¯æ—¶å…³è”å¯¹è±¡çš„å¤„ç†æš‚æ—¶ä¸åšè®¨è®ºï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥è‡ªå·±å»ç ”ç©¶ã€‚</p>
<h3 id="NSInvocation"><a href="#NSInvocation" class="headerlink" title="NSInvocation"></a>NSInvocation</h3><p>NSIncocationç»å¸¸è¢«ç”¨åœ¨å¯¹è±¡å’Œappé—´å­˜å‚¨å’Œè½¬å‘æ¶ˆæ¯ï¼›ä¸€ä¸ªNSInvocationå¯¹è±¡åŒ…å«äº†ä¸€ä¸ªæ¶ˆæ¯çš„æ‰€æœ‰å…ƒç´ ï¼šæ¥æ”¶å¯¹è±¡ã€æ–¹æ³•é€‰æ‹©å™¨ã€å‚æ•°å’Œè¿”å›å€¼ï¼Œä¸”è¿™äº›å…ƒç´ åœ¨NSInvocationå¯¹è±¡åˆ†å‘æ—¶éƒ½å¯ä»¥è¢«ä¿®æ”¹ã€‚<br>ä¸€ä¸ªNSInvocationå¯¹è±¡å¯ä»¥è¢«é‡å¤çš„å‘é€ä¸ªä¸åŒçš„æ¥æ”¶è€…ï¼Œå®ƒçš„å‚æ•°ä¹Ÿå¯ä»¥é’ˆå¯¹ä¸åŒçš„ç»“æœåœ¨åˆ†å‘æ—¶è¿›è¡Œä¿®æ”¹ï¼Œç”šè‡³å®ƒçš„æ–¹æ³•ä¹Ÿå¯ä»¥è¢«æ›¿æ¢ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•çš„ç­¾åç›¸åŒï¼ˆps:å‚æ•°å’Œè¿”å›ç±»å‹ç›¸åŒï¼‰çš„æƒ…å†µä¸‹ã€‚<br>NSInvocationä¸æ”¯æŒä½¿ç”¨å¯å˜å‚æ•°çš„åˆå§‹åŒ–æ–¹æ³•ï¼Œä½ åªèƒ½ä½¿ç”¨<code>invocationWithMethodSignature:</code>å»åˆ›å»ºå¯¹è±¡è€Œä¸æ˜¯ä½¿ç”¨<code>allocã€init</code>ã€‚<br><strong><em>NSInvocationéµå¾ªNSCodeingåè®®ï¼Œä½†æ˜¯å®ƒåªæ”¯æŒNSPortCoderåè®®ï¼Œä¸æ”¯æŒå¯¹è±¡çš„å½’æ¡£</em></strong></p>
<h3 id="CTMediatoré€šä¿¡æ–¹æ¡ˆ"><a href="#CTMediatoré€šä¿¡æ–¹æ¡ˆ" class="headerlink" title="CTMediatoré€šä¿¡æ–¹æ¡ˆ"></a>CTMediatoré€šä¿¡æ–¹æ¡ˆ</h3><p><a href="https://casatwy.com/iOS-Modulization.html" target="_blank" rel="noopener">CTMediator</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











  
    <article id="post-Cocoapodsé™æ€åº“æ•´ç†" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a  href="/2016/04/08/Cocoapodsé™æ€åº“æ•´ç†/" class="article-date">
      <time datetime="2016-04-07T16:00:00.000Z" itemprop="datePublished">2016-04-08</time>
</a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a  class="article-title" href="/2016/04/08/Cocoapodsé™æ€åº“æ•´ç†/">Cocoapodsé™æ€åº“æ•´ç†</a>
    </h1>
  


      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>#ä¸ºä½•é€‰æ‹©CocoaPodsåšé™æ€åº“</p>
<p>å…¬å¸é¡¹ç›®æ¡†æ¶æ¯”è¾ƒå¤§ï¼Œä¸ºäº†ä»¥åä¸šåŠ¡å‘å±•ï¼Œéœ€è¦å°†é¡¹ç›®åˆ†åŒ…ï¼Œæ‰€ä»¥å°†é¡¹ç›®çš„é€šç”¨å·¥å…·ã€ç½‘ç»œå±‚ä¸åŸºç±»å°æˆä¸€ä¸ªåŸºç¡€åŒ…ï¼›å¼€å§‹å‡†å¤‡å°†è¿™ä¸ªåŸºç¡€åŒ…æ‰“æˆframeworkï¼Œä½†è€ƒè™‘åˆ°ä»¥åä¸šåŠ¡ä¹Ÿéœ€è¦æ‰“åŒ…æ—¶ä¸å¥½å¼•å…¥åŸºç¡€åŒ…çš„ä¾èµ–ï¼Œé‚å°†åŸºç¡€åŒ…åšæˆäº†ä¸€ä¸ªç§æœ‰åº“ä¾›å›¢é˜Ÿç»´æŠ¤ä¸åæœŸå¼€å‘ã€‚</p>
<p>Cocoapodsåˆ›å»ºç§æœ‰åº“</p>
<p>1.åˆ›å»ºç§æœ‰repo</p>
<p>åœ¨ä½ çš„gitæœåŠ¡å™¨ä¸Šåˆ›å»ºä¸€ä¸ªä»“åº“ã€‚å› ä¸ºgithubä¸Šç§æœ‰ä»“åº“æ˜¯æ”¶è´¹çš„ï¼Œå¤§å®¶å¯ä»¥è‡ªå·±é€‰æ‹©gitæœåŠ¡å™¨ã€‚</p>
<p>åˆ›å»ºå¥½ä»“åº“ä»¥åæˆ‘ä»¬å¯ä»¥æ‰§è¡Œï¼š</p>
<p>pod repo add [repo_name] [repo_url]<br>repo_nameä½¿æˆ‘ä»¬çš„ä»“åº“çš„åç§°ï¼Œrepo_urlä¸ºä»“åº“åœ°å€(ps:ä¼˜å…ˆä½¿ç”¨httpsåœ°å€ï¼Œä½¿ç”¨sshåœ°å€æ—¶éœ€è¦é…ç½®gitçš„SSH keys)ï¼ŒæˆåŠŸåå¯ä»¥å‰å¾€æ–‡ä»¶å¤¹ ~/.cocoapods/reposä¼šçœ‹åˆ°æ€åº“å†…å®¹</p>
<p>2.åˆ›å»ºè‡ªå·±çš„Cocoapodsä¾èµ–åº“</p>
<p>1.é¦–å…ˆåœ¨gitä¸Šåˆ›å»ºä¸€ä¸ªä»“åº“ï¼Œè®°å¾—æ·»åŠ licenseæ–‡ä»¶å’Œremamdæ–‡ä»¶ã€‚</p>
<p>2.cloneä»“åº“åˆ°æœ¬åœ°</p>
<p>cd ~</p>
<p>git clone [repo_url]<br>3.å‘æœ¬åœ°ä»“åº“æäº¤æ–‡ä»¶</p>
<p>æ–°å»ºä¸€ä¸ªç±»ä¼¼æ–‡ä»¶å¤¹ç›®å½•ç»“æ„ï¼Œå°†ä»£ç .h.wæˆ–è€….swiftæ–‡ä»¶æ”¾åœ¨Calsssesæ–‡ä»¶å¤¹ä¸­</p>
<p>åœ¨Assetsæ–‡ä»¶å¤¹ä¸‹æ”¾å…¥ä¸€ä¸ªbundleèµ„æºæ–‡ä»¶åŒ…</p>
<p>4.ç”Ÿæˆpodspecæ–‡ä»¶å¹¶ç¼–è¾‘</p>
<p>cd ~/[project_name]</p>
<p>pod spec create [project_name]<br>æ‰“å¼€è¯¥æ–‡ä»¶ä¿®æ”¹å†…å®¹ä¸º</p>
<p>s.sourceè¡¨ç¤ºé¡¹ç›®åœ¨gitä¸Šçš„åœ°å€</p>
<p>s.source_filesè¡¨ç¤ºä»£ç æ–‡ä»¶åœ°å€</p>
<p>s.resourcesè¡¨ç¤ºèµ„æºæ–‡ä»¶åœ°å€</p>
<p>s.frameworksè¡¨ç¤ºå¯¹ç³»ç»Ÿåº“çš„ä¾èµ–</p>
<p>s.depencyè¡¨ç¤ºå¯¹ç¬¬ä¸‰æ–¹åº“çš„ä¾èµ–<br>5.Demoå·¥ç¨‹</p>
<p>ä½ å¯ä»¥åœ¨è¯¥æ–‡ä»¶ä¸‹æ·»åŠ demoæŒ‡å¯¼åˆ«äººä½¿ç”¨</p>
<p>3.å°†ä»£ç æäº¤åˆ°git</p>
<p>git add .</p>
<p>git commit -a -m â€˜firstâ€™</p>
<p>git tag -a 0.1.0 -m â€˜firstâ€™ (è¿™ä¸ªtagè¦ä¸ç‰ˆæœ¬å·ä¸€è‡´ï¼‰<br>4.éªŒè¯.podspecæ–‡ä»¶</p>
<p>pod lib lint xxx.podspec â€“allow-warnings â€“use-libraries<br>éªŒè¯é€šè¿‡ååªè¦å°†ä»£ç æ¨é€åˆ°gitä»“åº“ä¸Šå°±å¯ä»¥äº†</p>
<p>5.å°†podspecç»™åˆ°ç§æœ‰repo</p>
<p>pod repo push [repo_name] [xxx.podspec]<br>æˆåŠŸåå°±å¯ä»¥å»æœ¬åœ°repoåœ°å€æŸ¥çœ‹</p>
<p>Cocoapodsæ‰“åŒ…å¸¦ç§æœ‰åº“ä¾èµ–çš„framework</p>
<p>pod lib create GTEDXCalendar</p>
<p>What language do you want to use?? [ Swift / ObjC ]</p>
<p>ObjC</p>
<p>Would you like to include a demo application with your library?[ Yes / No]</p>
<p>No</p>
<p>Which testing frameworks will you use ? [ Specta / Kiwi  / None ]</p>
<p>None</p>
<p>Would you like to do view based testing? [ Yes / No ]</p>
<p>No</p>
<p>What is your class prefix ?</p>
<p>GTEDX<br>æˆåŠŸåæ‰“å¼€GTEDXCalendar.podspecæ–‡ä»¶ä¿®æ”¹</p>
<p>ä¿®æ”¹æ–¹æ³•å‚è€ƒä¸Šæ–‡</p>
<p>cd ~/GTEDXCalendar/Example</p>
<p>vim Podfile</p>
<p>åœ¨å¤´ä¸Šæ·»åŠ çº¢åœˆæ ‡æ³¨çš„ä»£ç </p>
<p>source â€˜<a href="https://github.com/CocoaPods/Specs.git&#39;" target="_blank" rel="noopener">https://github.com/CocoaPods/Specs.git&#39;</a></p>
<p>source private #ç§æœ‰ä»“åº“gitåœ°å€<br>ç„¶åæ‰§è¡Œpod install</p>
<p>å°†æºæ–‡ä»¶ä¸èµ„æºæ•°æ®æ”¾å…¥å¯¹åº”çš„Classesä¸Assetsæ–‡ä»¶ä¸­</p>
<p>æäº¤æºç å¹¶æ‰“ä¸Štag</p>
<p>éªŒè¯.podspecæ–‡ä»¶</p>
<p>pod lib lint GTEDXCalendar.podspec â€“allow-warnings â€“use-libraries â€“sources = private , <a href="https://github.com/CocoaPods/Specs.git" target="_blank" rel="noopener">https://github.com/CocoaPods/Specs.git</a><br>å®‰è£…æ’ä»¶</p>
<p>sudo gem install coocapods-packager<br>æ‰“åŒ…</p>
<p>pod package GTEDXCalendar.podspec â€“force â€“spec-sources=private , <a href="https://github.com/CocoaPods/Specs.git" target="_blank" rel="noopener">https://github.com/CocoaPods/Specs.git</a><br>ä½¿ç”¨framework</p>
<p>æ–°å»ºä¸€ä¸ªå·¥ç¨‹ï¼Œæ–°å»ºPodfileæ–‡ä»¶</p>
<p>åœ¨podfileæ–‡ä»¶ä¸­æ·»åŠ sourceåœ°å€</p>
<p>å°†ç§æœ‰åº“ä¸­ä¸frameworkçš„ä¾èµ–éƒ½åŠ å…¥podfileæ–‡ä»¶ä¸­ï¼ˆä¿æŒç‰ˆæœ¬ä¸€è‡´ï¼‰</p>
<p>ç„¶åå°†frameworkåŠ å…¥é¡¹ç›®å¹¶å°†frameworkå†…éƒ¨çš„bundleä¹Ÿæ‹–å…¥é¡¹ç›®</p>
<p>å‚è€ƒ</p>
<p>ä½¿ç”¨Cocoapodsåˆ¶ä½œé™æ€åº“</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











  
    <article id="post-GCDä½¿ç”¨æ€»ç»“" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a  href="/2016/03/03/GCDä½¿ç”¨æ€»ç»“/" class="article-date">
      <time datetime="2016-03-02T16:00:00.000Z" itemprop="datePublished">2016-03-03</time>
</a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a  class="article-title" href="/2016/03/03/GCDä½¿ç”¨æ€»ç»“/">GCDä½¿ç”¨æ€»ç»“</a>
    </h1>
  


      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>###ä»€ä¹ˆæ˜¯GCD<br>GCDå…¨ç§°ä¸ºGrand Centeral Dispatchï¼Œä¸ºiOSå’ŒOS Xçš„å¤šæ ¸ç¡¬ä»¶ä¸Šæ‰§è¡Œæä¾›æ§åˆ¶ï¼Œæ˜¯æ„ä¸æ‰§è¡Œä»»åŠ¡çš„æŠ€æœ¯ä¹‹ä¸€ã€‚<br>å¼€å‘è€…åªéœ€è¦å®šä¹‰æƒ³æ‰§è¡Œçš„ä»»åŠ¡å¹¶è¿½åŠ åˆ°é€‚å½“çš„Dispatch Queueä¸­ï¼ŒGCDå°±èƒ½ç”Ÿæˆå¿…è¦çš„çº¿ç¨‹å¹¶æ‰§è¡Œè®¡åˆ’ä»»åŠ¡ã€‚ç”±äºçº¿ç¨‹ç®¡ç†æ˜¯ä½œä¸ºç³»ç»Ÿçš„ä¸€éƒ¨åˆ†æ¥å®ç°çš„ï¼Œå› æ­¤å¯ä»¥ç»Ÿä¸€ç®¡ç†ï¼Œä¹Ÿå¯æ‰§è¡Œä»»åŠ¡ï¼Œè¿™æ ·å°±æ¯”ä»¥å‰çš„çº¿ç¨‹æ›´æœ‰æ•ˆç‡ã€‚ä¸¾ä¸ªğŸŒ°<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">dispatch_async(queue,^&#123;</span><br><span class="line">    /*</span><br><span class="line">    * é•¿æ—¶é—´ä»»åŠ¡å¤„ç†</span><br><span class="line">    *</span><br><span class="line">    * ä¾‹å¦‚æ•°æ®åº“è®¿é—®</span><br><span class="line">    */</span><br><span class="line">    /*</span><br><span class="line">    * é•¿æ—¶é—´å¤„ç†ç»“æŸï¼Œä¸»çº¿ç¨‹ä¸­ä½¿ç”¨ç»“æœ</span><br><span class="line">    */</span><br><span class="line">    dispatch_async(dispatch_get_main_queue(),^&#123;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>ä¸Šé¢ä»£ç å°±æ˜¯åœ¨åå°æ‰§è¡Œçº¿ç¨‹ä¸­æ‰§è¡Œé•¿æ—¶é—´å¤„ç†ï¼Œå¤„ç†ç»“æŸæ—¶ï¼Œä¸»çº¿ç¨‹ä½¿ç”¨è¯¥å¤„ç†ç»“æœçš„æºä»£ç ã€‚</p>
<p>###Dispatch Queueçš„ç§ç±»<br>Dispatch queueçš„ç§ç±»æœ‰ä¸¤ç§ï¼šä¸€ç§æ˜¯ç­‰å¾…æ‰§è¡Œä¸­å¤„ç†ç»“æŸçš„<strong>Serial Dispatch Queueï¼ˆä¸²è¡Œé˜Ÿåˆ—ï¼‰</strong>ï¼Œå¦ä¸€ç§æ˜¯ä¸ç­‰å¾…æ‰§è¡Œä¸­å¤„ç†çš„<strong>Concurrent Dispatch Queueï¼ˆå¹¶è¡Œé˜Ÿåˆ—ï¼‰</strong>ã€‚<br>è™½ç„¶æœ‰äº†Queueçš„ç§ç±»ï¼Œé‚£ä¹ˆå¦‚ä½•æ‰èƒ½å¾—åˆ°Dispatch queueå‘¢ï¼Ÿ</p>
<p>####dispatch_queue_create<br>ç¬¬ä¸€ä¸­æ–¹æ³•æ˜¯é€šè¿‡GCDçš„Apiç”ŸæˆDispatch Queue<br><figure class="highlight plain"><figcaption><span>myQueue </span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">```</span><br><span class="line"></span><br><span class="line">Serial Dispatch queueå¯ä»¥åœ¨åˆ›å»ºæ—¶ç”¨NULLæ ‡è¯†ï¼›å¤šä¸ªçº¿ç¨‹æ›´æ–°ç›¸åŒèµ„æºå¯¼è‡´æ•°æ®ç«äº‰æ—¶å»ºè®®ä½¿ç”¨Serial Dispatch Queue</span><br></pre></td></tr></table></figure></p>
<p>dispatch_queue_t myQueue = dispatch_queue_create(â€œcom.zeuszhang.gcd.myQueueâ€,DISPATCH_QUEUE_CONCURRENT);<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">####Main Dispatch Queue/Global Dispatch Queue</span><br><span class="line">ç¬¬äºŒç§æ–¹æ³•æ˜¯è·å–ç³»ç»Ÿæä¾›çš„Dispatch Queue</span><br><span class="line"></span><br><span class="line">Main Dispatch Queueä¸»çº¿ç¨‹åªæœ‰ä¸€ä¸ªè‡ªç„¶æ˜¯Serial dispatch queue</span><br><span class="line">dispatch_queue_t myQueue = dispatch_get_main_queue();</span><br></pre></td></tr></table></figure></p>
<p>Global Dispatch Queueæ˜¯æ‰€æœ‰ç¨‹åºéƒ½èƒ½å¤Ÿä½¿ç”¨Concurrent dispatch queueã€‚å¦å¤–Global Dispatch queueæœ‰4ä¸ªæ‰§è¡Œä¼˜å…ˆçº§<br>1.High Priority<br>2.Default Priority<br>3.Low Priority<br>4.Background Priority<br>dispatch_queue_t myQueue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_HIGH,0);//ç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºä¼˜å…ˆçº§<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">###dispatch_set_target_queue</span><br><span class="line">dispatch_queue_createå‡½æ•°ç”Ÿæˆçš„Dispatch Queueä¸ç®¡æ˜¯Serial dispatch queueè¿˜æ˜¯Concurrent dispatch queueï¼Œéƒ½ä½¿ç”¨é»˜è®¤ä¼˜å…ˆçº§ï¼ˆdefaultï¼‰Global Dispatch queueç›¸åŒæ‰§è¡Œä¼˜å…ˆçº§çš„çº¿ç¨‹ã€‚è€Œå˜æ›´ç”Ÿæˆçš„Dispatch queueçš„ä¼˜å…ˆçº§éœ€è¦ç”¨åˆ°dispatch_set_target_queueå‡½æ•°ã€‚ğŸŒ°å¦‚ä¸‹</span><br></pre></td></tr></table></figure></p>
<p>dispatch_queue_t myQueue = dispatch_queue_create(â€œcom.zeuszhang.gcd.myQueueâ€,NULL);<br>dispatch_queue_t globalQueueBackground = dispatch_queue_create(DISPATCH_QUEUE_PRIORITY_BACKROUND,0);<br>dispatch_set_target_queue(myQueue,globalQueueBackground);<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">æŒ‡å®šå˜æ›´ä¼˜å…ˆçº§çš„Dispatch Queueä¸ºdispatch_set_target_queueå‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°ï¼ŒæŒ‡å®šè¦ä½¿ç”¨çš„æ‰§è¡Œä¼˜å…ˆçº§çš„Global dispatch queueä¸ºç¬¬äºŒä¸ªå‚æ•°ï¼›**psï¼ˆç¬¬ä¸€ä¸ªå‚æ•°ä¸å¯æŒ‡å®šä¸ºç³»ç»Ÿæä¾›çš„Main Dispatch Queueæˆ–è€…Global Dispatch Queueï¼‰**</span><br><span class="line"></span><br><span class="line">###dispatch_after</span><br><span class="line">GCDå»¶æ—¶å‡½æ•°</span><br></pre></td></tr></table></figure></p>
<p>dispatch_time_t time = dispatch_time(DISPATCH_TIME_NOW, 3ull * NSEC_PER_SEC);<br>dispatch_after(time,dispatch_get_main_queue(),^{<br>    NSLog(@â€waited at least three secondsâ€);<br>})<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">éœ€è¦æ³¨æ„çš„æ˜¯dispatch_afterå‡½æ•°å¹¶ä¸æ˜¯åœ¨æŒ‡å®šæ—¶é—´åæ‰§è¡Œå¤„ç†ï¼Œè€Œåªæ˜¯åœ¨æŒ‡å®šæ—¶é—´è¿½åŠ å¤„ç†åˆ°Dispatch Queueã€‚</span><br><span class="line"></span><br><span class="line">###Dispatch Group</span><br><span class="line">åœ¨Dispatch Queueä¸­å¤„ç†å¤šä¸ªå…¨éƒ¨ç»“æŸåæƒ³æ‰§è¡Œçš„æ“ä½œï¼Œå°±å¯ä»¥ä½¿ç”¨Dispatch Groupæ¥ä½¿ä»£ç æ›´ç®€å•</span><br></pre></td></tr></table></figure></p>
<p>dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT,0);<br>dispatch_group_t group = dispatch_group_create();<br>dispatch_group_async(group,queue,^{NSLog(@â€b1k0â€);});<br>dispatch_group_async(group,queue,^{NSLog(@â€b1k1â€);});<br>dispatch_group_async(group,queue,^{NSLog(@â€b1k2â€);});<br>dispatch_group_notify(group,dispatch_get_main_queue(),^{NSLog(@â€dineâ€);});<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">åœ¨dispatch_group_notifyå‡½æ•°ä¸­ä¸ç®¡åˆ¶å®šä»€ä¹ˆæ ·çš„Dispatch Queueï¼Œå±äºDispatch Groupçš„å…¨éƒ¨å¤„ç†å†è¿½åŠ åˆ¶å®šçš„Blockæ—¶éƒ½å·²ç»æ‰§è¡Œç»“æŸã€‚å¦å¤–ï¼Œåœ¨Dispatch Groupä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨dispatch_group_waitå‡½æ•°ä»…ç­‰å¾…å…¨éƒ¨å¤„ç†æ‰§è¡Œç»“æŸã€‚</span><br></pre></td></tr></table></figure></p>
<p>dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT,0);<br>dispatch_group_t group = dispatch_group_create();<br>dispatch_group_async(group,queue,^{NSLog(@â€b1k0â€);});<br>dispatch_group_async(group,queue,^{NSLog(@â€b1k1â€);});<br>dispatch_group_async(group,queue,^{NSLog(@â€b1k2â€);});<br>dispatch_group_wait(group,DISPATCH_TIME_FORVER);<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dispatch_group_waitå‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šä¸ºç­‰å¾…æ—¶é—´å±äºdispatch_time_tç±»å‹çš„å€¼</span><br></pre></td></tr></table></figure></p>
<p>dispatch_time_t time = dispatch_time(DISPATCH_TIME_NOW, 1ull * NSEC_PER_SEC);<br>long result - dispatch_group_wait(group,time);<br>if (result == 0) {<br>    //groupçš„å¤„ç†å…¨éƒ¨ç»“æŸ<br>} else {<br>    //groupå¤„ç†ä¸­<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">å¦‚æœdispatch_group_waitçš„è¿”å›å€¼ä¸ä¸º0ï¼Œå°±æ„å‘³ç€è™½ç„¶è¿‡äº†æŒ‡å®šçš„æ—¶é—´ï¼Œä½†groupä¸­è¿˜æœ‰å¤„ç†æ²¡æœ‰ç»“æŸï¼›è‹¥ä¸º0ï¼Œåˆ™å…¨éƒ¨å¤„ç†æ‰§è¡Œå®Œæ¯•ã€‚å½“ç­‰å¾…æ—¶é—´ä¸ºDISPATCH_TIME_FOREVER,ç”±groupçš„å¤„ç†å¿…å®šå…¨éƒ¨ç»“æŸã€‚</span><br><span class="line"></span><br><span class="line">###dispatch_barrier_async</span><br><span class="line">åœ¨è®¿é—®æ•°æ®åº“æ—¶ï¼Œå‰é¢è¯´ç”¨Serial dispatch queueå¯ä»¥é¿å…æ•°æ®ç«äº‰ã€‚å†™å…¥ä¸å¯ä»¥ä¸è¯»å–å¤„ç†å¹¶è¡Œæ“ä½œï¼Œä½†æ˜¯å¦‚æœæ˜¯è¯»å†™ä¸è¯»å†™æ˜¯å¯ä»¥å¹¶è¡Œçš„ã€‚</span><br><span class="line">ä¹Ÿå°±æ˜¯ä¸ºäº†é«˜æ•ˆè®¿é—®ï¼Œè¯»å–å¤„ç†è¿½åŠ åˆ°Concurrent dispatch queueä¸­ï¼Œå†™å…¥å¤„ç†åœ¨ä»»ä¸€ä¸ªè¯»å–å¤„ç†æ²¡æœ‰æ‰§è¡Œçš„çŠ¶æ€ä¸‹è¿½åŠ åˆ°Serial dispatch queueä¸­å³å¯ã€‚è™½ç„¶ç”¨groupæœˆdispatch_set_target_queueä¹Ÿå¯ä»¥å¤„ç†ï¼Œä½†ä»£ç é€»è¾‘å¤æ‚ï¼Œè¿™é‡Œæä¾›ä¸€ä¸ªç®€å•æ–¹æ³•**dispatch_barrier_async**</span><br><span class="line">ğŸŒ°ï¼š</span><br></pre></td></tr></table></figure></p>
<p>é¦–å…ˆç”Ÿæˆä¸€ä¸ªConcurrent dispatch queueåœ¨queueä¸­è¿½åŠ è¯»å–å¤„ç†<br>dispatch_queue_t queue = dispatch_queue_create(â€œcom.zueszhang.gcd.forBarrierâ€,DISPATCH_QUEUE_CONCURRENT);<br>dispatch_async(queue,b1k0_fro_reading);<br>dispatch_async(queue,b1k1_fro_reading);<br>dispatch_async(queue,b1k2_fro_reading);<br>dispatch_async(queue,b1k3_fro_reading);<br>dispatch_barrier_async(b1k_for_writing);<br>dispatch_async(queue,b1k4_fro_reading);<br>dispatch_async(queue,b1k5_fro_reading);<br>dispatch_async(queue,b1k6_fro_reading);<br>dispatch_async(queue,b1k7_fro_reading);<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">###dispatch_sync</span><br><span class="line">dispatch_syncå°±æ˜¯å°†æŒ‡å®šçš„block***åŒæ­¥***çš„è¿½åŠ åˆ°æŒ‡å®šçš„Dispatch Queueä¸­ï¼Œå†è¿½åŠ Blockç»“æŸä¹‹å‰ï¼Œdispatch_syncå‡½æ•°ä¼šä¸€ç›´ç­‰å¾…ã€‚</span><br><span class="line"></span><br><span class="line">###dispatch_apply</span><br><span class="line">dispatch_applyå‡½æ•°æ˜¯å°†dispatch_syncå’ŒDispatch Groupå…³è”çš„apiã€‚è¯¥å‡½æ•°æŒ‰æŒ‡å®šçš„æ¬¡æ•°å°†æŒ‡å®šçš„Blockè¿½åŠ åˆ°æŒ‡å®šçš„Dispatch Queueä¸­ï¼Œå¹¶ç­‰å¾…å…¨éƒ¨å¤„ç†ç»“æŸ</span><br><span class="line">ğŸŒ°</span><br></pre></td></tr></table></figure></p>
<p>dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT,0);<br>dispatch_apply(10,queue,^(size_t index) {<br>    NSLog(@â€%zuâ€,index)<br>})<br>NSLog(@â€Doneâ€);<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">å› ä¸ºåœ¨Global Dispatch queueä¸­å¤„ç†æ‰€ä»¥çº¿ç¨‹ï¼Œæ‰€ä»¥å„ä¸ªæ“ä½œæ—¶é—´ä¸å®šã€‚ä½†æ˜¯Doneè‚¯å®šæ˜¯åœ¨æœ€åè¢«è¾“å‡ºã€‚</span><br><span class="line">ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºé‡å¤æ¬¡æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯è¿½åŠ å¯¹è±¡çš„Dispatch Queueï¼Œç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºè¿½åŠ çš„blockå¤„ç†ã€‚</span><br><span class="line">å¸¸ç”¨ä½œä¸å¯¹æ•°ç»„ç±»å¯¹è±¡çš„æ‰€æœ‰å…ƒç´ æ‰§è¡Œå¤„ç†æ—¶ï¼Œå¯ä»¥æ›¿ä»£forå¾ªç¯çš„æ•ˆæœã€‚</span><br><span class="line">å¦å¤–ï¼Œç”±äºdispatch_applyå‡½æ•°ä¹Ÿä¸dispatch_syncå‡½æ•°ç›¸åŒï¼Œä¼šç­‰å¾…å¤„ç†æ‰§è¡Œç»“æŸï¼Œå› æ­¤æ¨èåœ¨dispatch_asyncå‡½æ•°ä¸­éåŒæ­¥çš„æ‰§è¡Œdispatch_apply</span><br></pre></td></tr></table></figure></p>
<p>dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT,0);<br>//åœ¨global dipsatch queueä¸­éåŒæ­¥æ‰§è¡Œ<br>dispatch_async(queue,^{<br>    //ç­‰å¾…dispatch_applyå‡½æ•°ä¸­å…¨éƒ¨å¤„ç†ç»“æŸ<br>    dispatch_apply([array count],queue,^(size_t index){<br>        //å¹¶åˆ—å¤„ç†åŒ…å«åœ¨arrayä¸­çš„å…¨éƒ¨å¯¹è±¡<br>        NSLog(@â€%zu:%@â€,index,[array objectAtIndex:index]);<br>    });<br>    //ç­‰å¾…å®Œæ¯•ååœ¨mainä¸­æ‰§è¡Œå¤„ç†<br>    dispatch_async(dispatch_get_main_queue(),^{<br>        NSLog(@â€Doneâ€);<br>    });<br>});<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">###dispatch_suspend / dispatch_resume</span><br><span class="line">å½“è¿½åŠ å¤§é‡å¤„ç†åˆ°Disaptch Queueæ—¶ï¼Œå†è¿½åŠ å¤„ç†çš„è¿‡ç¨‹ä¸­ï¼Œæœ‰æ—¶å¸Œæœ›ä¸æ‰§è¡Œå·²è¿½åŠ çš„å¤„ç†ã€‚ä¾‹å¦‚æ¼”ç®—ç»“æœè¢«blockæˆªè·æ—¶ï¼Œä¸€äº›å¤„ç†ä¼šå¯¹è¿™ä¸ªç»“æœé€ æˆå½±å“ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œåªè¦æŒ‚èµ·Dispatch Queueå³å¯ï¼Œå½“å¯æ‰§è¡Œæ—¶å†æ¢å¤ã€‚</span><br><span class="line"></span><br><span class="line">###Dispatch Semaphore</span><br><span class="line">å½“å¹¶è¡Œæ‰§è¡Œçš„å¤„ç†æ›´æ–°æ•°æ®æ—¶ï¼Œä¼šäº§ç”Ÿæ•°æ®ç«äº‰çš„å¯èƒ½ï¼Œæœ‰æ—¶è¿˜ä¼šå¯¼è‡´ç¨‹åºå¼‚å¸¸ã€‚è™½ç„¶é€šè¿‡Serial Dispatch Queueå’Œdispatch_barrier_asyncå‡½æ•°å¯ä»¥é¿å…è¿™ç±»é—®é¢˜ï¼Œä½†æ˜¯æœ‰å¿…è¦æ›´ç»†åŠ›åº¦çš„æ§åˆ¶å®ƒã€‚</span><br><span class="line">ğŸŒ°ï¼šä¸è€ƒè™‘æ’åºï¼Œå°†æ‰€æœ‰æ•°æ®è¿½åŠ åˆ°NSMutableArrayä¸­ã€‚</span><br></pre></td></tr></table></figure></p>
<p>dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT,0);<br>NSMutableArray *array = [[NSMutableArray alloc] init];<br>for (int i = 0; i &lt; 10000; i++) {<br>    dispatch_async(queue,^{<br>        [array addObject:[NSNumber numberWithInt:i]];<br>    });<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">æ­¤æ—¶ï¼Œä½¿ç”¨globalæ›´æ–°NSMutableArrayå¯¹è±¡ï¼Œæ‰€ä»¥æ‰§è¡Œåç”±å†…å­˜é”™è¯¯å¯¼è‡´ç¨‹åºå¼‚å¸¸ç»“æŸæ¦‚ç‡å¾ˆé«˜ã€‚æ­¤æ—¶åº”è¯¥ä½¿ç”¨Dispatch Semaphoreã€‚</span><br><span class="line">Dispatch Semaphoreæ˜¯æŒæœ‰è®¡æ•°çš„ä¿¡å·ï¼Œè¯¥è®¡æ•°æ˜¯å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­çš„è®¡æ•°ç±»å‹ä¿¡å·ã€‚åœ¨Dispatch Semaphoreä¸­ï¼Œè®¡æ•°ä¸º0æ—¶ç­‰å¾…ï¼Œè®¡æ•°ä¸º1æˆ–å¤§äº1æ—¶ï¼Œå‡å»1è€Œä¸ç­‰å¾…ã€‚</span><br></pre></td></tr></table></figure></p>
<p>dispatch_semaphore_t semaphore = dispatch_semaphore_create(1);<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å‚æ•°è¡¨ç¤ºè®¡æ•°çš„åˆå§‹å€¼ã€‚ä»å‡½æ•°åˆ›å»ºåç§°ä¸­createå¯ä»¥çœ‹å‡ºï¼Œè¯¥å‡½æ•°ä¸Dispatch Queueå’ŒDispatch Groupä¸€æ ·ï¼Œå¿…é¡»é€šè¿‡dispatch_releaseå‡½æ•°é‡Šæ”¾ã€‚</span><br><span class="line">dispatch_semaphore_waitå‡½æ•°ç­‰å¾…Dispatch Semaphoreçš„è®¡æ•°å€¼è¾¾åˆ°å¤§äºæˆ–ç­‰äº1ã€‚å½“è®¡æ•°å€¼å¤§äºç­‰äº1ï¼Œæˆ–è€…åœ¨å¾…æœºä¸­è®¡æ•°å€¼å¤§äºç­‰äº1æ—¶ï¼Œå¯¹è¯¥è®¡æ•°è¿›è¡Œå‡æ³•å¹¶ä»dispatch_semaphore_waitå‡½æ•°è¿”å›ã€‚ç¬¬äºŒä¸ªå‚æ•°ä¸dispatch_group_waitå‡½æ•°ç­‰ç›¸åŒï¼Œç”±dispatch_time_tç±»å‹å€¼æŒ‡å®šç­‰å¾…æ—¶é—´ã€‚</span><br><span class="line">ğŸŒ°ï¼š</span><br></pre></td></tr></table></figure></p>
<p>dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT,0);<br>dispatch_semaphore_t semaphore = dispatch_semaphore_create(1);<br>NSMutableArray *array = [[NSMutableArray alloc] init];<br>for (int i = 0; i &lt; 10000; ++i) {<br>    dispatch_async(queue,^{<br>        dispatch_semaphore_wait(semaphore,DISPATCH_TIME_FOREVER);<br>        [array addObject:[NSNumber numberWithInt:i]];<br>        dispatch_semaphore_signal(semaphore);<br>    })<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">###dispatch_once</span><br><span class="line">è¿™ä¸ªåº”è¯¥æ˜¯æœ€å¸¸ç”¨çš„GCD apiäº†ã€‚è¯¥å‡½æ•°æ˜¯ä¿è¯åœ¨åº”ç”¨ç¨‹åºä¸­æ‰§è¡Œä¸€æ¬¡æŒ‡å®šå¤„ç†çš„Apiã€‚</span><br><span class="line">iOSå•ä¾‹æ¨¡å¼ï¼š</span><br></pre></td></tr></table></figure></p>
<p>static id manager = nil;<br>-(id)defaultManager {<br>    static dispatch_once_t once;<br>    dispatch_once(&amp;once,^{<br>        manager = [[self alloc] init];<br>    });<br>    return manager;<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">###Dispatch I/O</span><br><span class="line">è¯»å–è¾ƒå¤§æ–‡ä»¶æ—¶ï¼Œå¦‚æœå°†æ–‡ä»¶åˆ†æˆåˆé€‚çš„å¤§å°å¹¶ä½¿ç”¨Global Dispatch Queueå¹¶åˆ—è¯»å–çš„è¯ï¼Œåº”è¯¥ä¼šæ¯”ä¸€èˆ¬çš„è¯»å–é€Ÿåº¦å¿«ä¸å°‘ã€‚ç°ä»Šçš„è¾“å…¥/è¾“å‡ºç¡¬ä»¶å·²ç»å¯ä»¥åšåˆ°ä¸€æ¬¡ä½¿ç”¨å¤šä¸ªçº¿ç¨‹æ›´å¿«çš„å¹¶åˆ—è¯»å–äº†ã€‚èƒ½å®ç°è¿™ä¸€åŠŸèƒ½çš„å°±æ˜¯Dispatch I/Oå’ŒDispatch Dataé€šè¿‡Dispatch I/Oè¯»å†™æ–‡ä»¶æ—¶ï¼Œä½¿ç”¨Global Dispatch Queueå°†1ä¸ªæ–‡ä»¶æŒ‰æŸä¸ªå¤§å°read/write</span><br></pre></td></tr></table></figure></p>
<p>disaptch_async(queue,^{/<em>è¯»å–  0 ~ 800å­—èŠ‚</em>/});<br>disaptch_async(queue,^{/<em>è¯»å–  801 ~ 1600å­—èŠ‚</em>/});<br>disaptch_async(queue,^{/<em>è¯»å–  1601 ~ 2400å­—èŠ‚</em>/});<br>disaptch_async(queue,^{/<em>è¯»å–  2401 ~ end</em>/});<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">åƒä¸Šé¢è¿™æ ·ï¼Œå°†æ–‡ä»¶åˆ†å‰²ä¸ºä¸€å—ä¸€å—çš„è¿›è¡Œè¯»å–å¤„ç†ã€‚åˆ†å‰²è¯»å–çš„æ•°æ®é€šè¿‡ä½¿ç”¨Dispatch Dataå¯è¿›è¡Œæ›´ä¸ºç®€å•çš„è¿›è¡Œç»“åˆå’Œåˆ†å‰²</span><br><span class="line">ğŸŒ°ï¼š</span><br></pre></td></tr></table></figure></p>
<p>pipe_q = dispatch_queue_create(â€œPipeQâ€,NULL);<br>pipe_channel = dispatch_io_create(DISPATCH_IO_STREAM,fd,pipe_q,^(int err) {<br>    close(fd);<br>})</p>
<p><em>out_fd = fdpair[1];<br>dispatch_io_set_low_water(pipe_channel,SIZE_MAX);<br>dispatch_id_read(pipe_channel, 0, SIZE_MAX, pipe_q,^(bool done,     dispatch_data_t pipedata, int err) {<br>    if (err == 0) {<br>        size_t len = dispatch_data_get_size(pipedata);<br>        if (len &gt; 0) {<br>            const char </em>bytes = NULL;<br>            char <em>encoded;<br>            dispatch_data_t md = dispatch_data_create_map(pipedata,(const void <strong>)&amp;bytes, &amp;len);<br>            encoded -asl_core_encode_buffer(bytes,len);<br>            asl_set((aslmsg)merged_msg,ASL_KEY_AUX_DATA,encoded);<br>            free(encoded);<br>            _asl_send_message(NULL,merged_msg,-1,NULL);<br>            asl_msg_release(merged_msg);<br>            dispatch_release(md);<br>        }<br>    }<br>    if (done) {<br>        dispatch_semphore_signal(sem);<br>        dispatch_release(pipe_channel);<br>        dispatch_release(pipe_q);<br>    }<br>});<br><code>`</code>
</strong></em>åŒæ ·ä½¿ç”¨â€createâ€ç”Ÿæˆçš„å¯¹è±¡æœ€åéƒ½è¦é‡Šæ”¾ã€‚***</p>
<p>###Disaptch Source<br>GCDä¸­é™¤äº†ä¸»è¦çš„Dispatch Queueå¤–ï¼Œè¿˜æœ‰ä¸å¤ªå¼•äººæ³¨ç›®çš„Dispatch Sourceã€‚ä»–æ˜¯BSDç³»å†…æ ¸æƒ¯æœ‰åŠŸèƒ½kqueueçš„åŒ…è£…ã€‚<br>kqueueæ˜¯åœ¨XNUå†…æ ¸ä¸­å‘ç”Ÿå„ç§äº‹ä»¶æ—¶ï¼Œåœ¨åº”ç”¨ç¨‹åºç¼–ç¨‹æ–¹æ‰§è¡Œå¤„ç†çš„æŠ€æœ¯(psä¸é‡è¦)ã€‚å®ƒçš„CPUè´Ÿè·éå¸¸å°ï¼Œå°½é‡ä¸å ç”¨èµ„æºã€‚<br>Dispatch Sourceç§ç±»</p>
<table>
<thead>
<tr>
<th>åç§°</th>
<th style="text-align:center">ç§ç±»</th>
</tr>
</thead>
<tbody>
<tr>
<td>DISPATCH_SOURCE_TYPE_DATA_ADD</td>
<td style="text-align:center">å˜é‡å¢åŠ </td>
</tr>
<tr>
<td>DISPATCH_SOURCE_TYPE_DATA_OR</td>
<td style="text-align:center">å˜é‡OR</td>
</tr>
<tr>
<td>DISPATCH_SOURCE_TYPE_MACH_SEND</td>
<td style="text-align:center">ç«¯å£å‘é€</td>
</tr>
<tr>
<td>DISPATCH_SOURCE_TYPE_MACH_RECV</td>
<td style="text-align:center">ç«¯å£æ¥æ”¶</td>
</tr>
<tr>
<td>DISPATCH_SOURCE_TYPE_PROC</td>
<td style="text-align:center">æ£€æµ‹åˆ°ä¸è¿›ç¨‹æœ‰å…³çš„äº‹ä»¶</td>
</tr>
<tr>
<td>DISPATCH_SOURCE_TYPE_READ</td>
<td style="text-align:center">å¯è¯»å–æ–‡ä»¶æ˜ åƒ</td>
</tr>
<tr>
<td>DISPATCH_SOURCE_TYPE_SIGNAL</td>
<td style="text-align:center">æ¥æ”¶ä¿¡å·</td>
</tr>
<tr>
<td>DISPATCH_SOURCE_TYPE_TIMER</td>
<td style="text-align:center">å®šæ—¶å™¨</td>
</tr>
<tr>
<td>DISPATCH_SOURCE_TYPE_VNODE</td>
<td style="text-align:center">æ–‡ä»¶ç³»ç»Ÿå˜æ›´</td>
</tr>
<tr>
<td>DISPATCH_SOURCE_TYPE_WRITE</td>
<td style="text-align:center">å¯å†™å…¥æ˜ åƒ</td>
</tr>
</tbody>
</table>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











  
    <article id="post-iOSå®šæ—¶å™¨æ•´ç†å¯¹æ¯”" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a  href="/2016/01/21/iOSå®šæ—¶å™¨æ•´ç†å¯¹æ¯”/" class="article-date">
      <time datetime="2016-01-20T16:00:00.000Z" itemprop="datePublished">2016-01-21</time>
</a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a  class="article-title" href="/2016/01/21/iOSå®šæ—¶å™¨æ•´ç†å¯¹æ¯”/">iOSå®šæ—¶å™¨æ•´ç†å¯¹æ¯”</a>
    </h1>
  


      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="NSTimer"><a href="#NSTimer" class="headerlink" title="NSTimer"></a>NSTimer</h2><h4 id="ä»€ä¹ˆæ˜¯NSTimer"><a href="#ä»€ä¹ˆæ˜¯NSTimer" class="headerlink" title="ä»€ä¹ˆæ˜¯NSTimer"></a>ä»€ä¹ˆæ˜¯NSTimer</h4><p>é€šè¿‡å®˜æ–¹æ–‡æ¡£â€A timer provides a way to perform a delayed ation or a periodic action. The timer waits until a certain time interval has elapsed and then fires, sending a specified message to a specified objec.â€ç¿»è¯‘è¿‡æ¥å°±æ˜¯timerå°±æ˜¯ä¸€ä¸ªèƒ½ä»ç°åœ¨å¼€å§‹çš„åé¢æŸä¸ªæ—¶åˆ»æˆ–è€…å‘¨æœŸæ€§çš„æ‰§è¡Œæˆ‘ä»¬åˆ¶å®šçš„æ–¹æ³•å¯¹è±¡ã€‚</p>
<h4 id="NSTimerå’Œå®ƒè°ƒç”¨çš„å‡½æ•°å¯¹è±¡"><a href="#NSTimerå’Œå®ƒè°ƒç”¨çš„å‡½æ•°å¯¹è±¡" class="headerlink" title="NSTimerå’Œå®ƒè°ƒç”¨çš„å‡½æ•°å¯¹è±¡"></a>NSTimerå’Œå®ƒè°ƒç”¨çš„å‡½æ•°å¯¹è±¡</h4><p>ä»å‰é¢å®˜æ–¹è§£é‡Šå¯ä»¥çœ‹å‡ºtimerä¼šåœ¨æœªæ¥çš„æŸä¸ªæ—¶åˆ»æ‰§è¡Œä¸€æ¬¡æˆ–è€…å¤šæ¬¡æ‰§è¡Œæˆ‘ä»¬æŒ‡å®šçš„æ–¹æ³•ï¼Œè¿™ä¹Ÿå°±ç‰µæ‰¯å‡ºä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä½•ä¿è¯timerè§¦å‘æ—¶ï¼Œæˆ‘ä»¬æŒ‡å®šçš„æ–¹æ³•æ˜¯æœ‰æ•ˆçš„å‘¢ï¼Ÿç­”æ¡ˆå¾ˆç®€å•ï¼Œå°±æ˜¯timerå¯¹å®ƒçš„targetè¿›è¡Œretainï¼Œæˆ‘ä»¬éœ€è¦å°å¿ƒå¯¹å¾…targetçš„ç”Ÿå‘½å‘¨æœŸé—®é¢˜ï¼Œå°¤å…¶æ˜¯é‡å¤æ€§çš„timerã€‚åœ¨timerè§¦å‘æˆ‘ä»¬æŒ‡å®šçš„æ–¹æ³•åï¼Œæˆ‘ä»¬éœ€è¦é‡Šæ”¾timerï¼Œè¿™é‡Œæä¾›äº†invalidateæ–¹æ³•ï¼Œå¦åˆ™è¢«retainçš„æ–¹æ³•å†…å¯¹è±¡å°†ä¸€ç›´å­˜åœ¨ï¼Œé€ æˆå†…å­˜æ³„æ¼ã€‚</p>
<h4 id="NSTimerä¼šå‡†æ—¶è§¦å‘äº‹ä»¶å—ï¼Ÿ"><a href="#NSTimerä¼šå‡†æ—¶è§¦å‘äº‹ä»¶å—ï¼Ÿ" class="headerlink" title="NSTimerä¼šå‡†æ—¶è§¦å‘äº‹ä»¶å—ï¼Ÿ"></a>NSTimerä¼šå‡†æ—¶è§¦å‘äº‹ä»¶å—ï¼Ÿ</h4><p>è¿™ä¸ªç­”æ¡ˆæ˜¯å¦å®šçš„ï¼Œè€Œä¸”æœ‰æ—¶å€™ä¼šå‘ç°å®é™…è§¦å‘æ—¶é—´è·Ÿä½ è®¾å®šçš„æ—¶é—´ä¼šå·®è·æŒºå¤§çš„ï¼Œè¿™è¦ä»NSTimerçš„å®ç°è¯´èµ·ã€‚<br>NSTimerä¸æ˜¯ä¸€ä¸ªå®æ—¶ç³»ç»Ÿï¼Œæ‰€ä»¥timerè§¦å‘çš„æ—¶æœºä¼šæœ‰è¯¯å·®ï¼Œå·®è·çš„å¤§å°ä¸»è¦è·Ÿå½“å‰æˆ‘ä»¬ç¨‹åºçš„æ‰§è¡Œæƒ…å†µæœ‰å…³ç³»ï¼Œæ¯”å¦‚ç¨‹åºæ˜¯å¤šçº¿ç¨‹çš„ï¼Œè€Œtimeråªæ˜¯æ·»åŠ åœ¨æŸä¸€ä¸ªçº¿ç¨‹çš„Runloopçš„æŸä¸€ç§æŒ‡å®šçš„runloopmodeä¸­ï¼Œç”±äºå¤šçº¿ç¨‹é€šå¸¸éƒ½æ˜¯åˆ†æ—¶æ‰§è¡Œï¼Œè€Œä¸”æ¯æ¬¡æ‰§è¡Œçš„modeä¹Ÿå¯èƒ½éšç€æ—¶æœºæƒ…å†µå˜åŒ–è€Œæ”¹å˜ï¼Œæˆ–è€…åœ¨æŸä¸€ä¸ªæ—¶åˆ»çº¿ç¨‹æœ‰å¤§é‡å¤æ‚çš„è¿ç®—ã€‚è¿™äº›éƒ½ä¼šå¯¼è‡´timerçš„è§¦å‘æ—¶æœºä¸å¤Ÿç²¾å‡†ã€‚</p>
<h2 id="CADisplayLink"><a href="#CADisplayLink" class="headerlink" title="CADisplayLink"></a>CADisplayLink</h2><h4 id="ä»€ä¹ˆæ˜¯CADisplayLink"><a href="#ä»€ä¹ˆæ˜¯CADisplayLink" class="headerlink" title="ä»€ä¹ˆæ˜¯CADisplayLink"></a>ä»€ä¹ˆæ˜¯CADisplayLink</h4><p>CADisplayLinkæ˜¯ä¸€ä¸ªèƒ½è®©æˆ‘ä»¬ä»¥å’Œå±å¹•åˆ·æ–°ç‡ç›¸åŒçš„é¢‘ç‡å°†å†…å®¹ç»˜åˆ¶åˆ°å±å¹•ä¸Šçš„å®šæ—¶å™¨ã€‚</p>
<h4 id="CADisplayLinkå’Œå®ƒè°ƒç”¨çš„å‡½æ•°å¯¹è±¡"><a href="#CADisplayLinkå’Œå®ƒè°ƒç”¨çš„å‡½æ•°å¯¹è±¡" class="headerlink" title="CADisplayLinkå’Œå®ƒè°ƒç”¨çš„å‡½æ•°å¯¹è±¡"></a>CADisplayLinkå’Œå®ƒè°ƒç”¨çš„å‡½æ•°å¯¹è±¡</h4><p>æˆ‘ä»¬åœ¨åº”ç”¨ä¸­åˆ›å»ºä¸€ä¸ªCADisplayLinkå¯¹è±¡ï¼ŒæŠŠå®ƒæ·»åŠ åˆ°ä¸€ä¸ªRunLoopä¸­ï¼Œå¹¶ç»™ä»–æä¾›ä¸€ä¸ªtargetå’Œselectoråœ¨å±å¹•åˆ·æ–°çš„æ—¶å€™è°ƒç”¨ï¼›ä¸€æ—¦è¯¥å¯¹è±¡è¢«ä»¥ç‰¹å®šæ¨¡å¼æ³¨å†Œåˆ°RunLoopä¸­ï¼Œæ¯å½“å±å¹•åˆ·æ–°æ—¶ï¼ŒRunLoopå°±ä¼šä¸»åŠ¨è°ƒç”¨è¯¥å¯¹è±¡ç»‘å®šçš„targetä¸Šçš„selectorï¼Œè¿™æ—¶targetå¯ä»¥æ‹¿åˆ°CADisplayLinkè°ƒç”¨çš„æ—¶é—´æˆ³ï¼Œç”¨æ¥å‡†å¤‡ä¸‹ä¸€å¸§çš„æ•°æ®ã€‚</p>
<h4 id="CADisplayLinkçš„å‡†ç¡®æ€§"><a href="#CADisplayLinkçš„å‡†ç¡®æ€§" class="headerlink" title="CADisplayLinkçš„å‡†ç¡®æ€§"></a>CADisplayLinkçš„å‡†ç¡®æ€§</h4><p>iOSè®¾å¤‡çš„å±å¹•åˆ·æ–°é¢‘ç‡æ˜¯å›ºå®šçš„ï¼ŒCADisplayLinkåœ¨æ­£å¸¸æƒ…å†µä¸‹ä¼šåœ¨æ¯æ¬¡åˆ·æ–°ç»“æŸéƒ½è¢«è°ƒç”¨ï¼Œç²¾åº¦æ¯”NSTimerè¦é«˜å¾ˆå¤šï¼Œä½†æ˜¯CADisplayLinké€‚ç”¨åœºåˆç›¸å¯¹ä¸“ä¸€ï¼Œé€‚åˆåšUIçš„ä¸åœé‡ç»˜ï¼Œæ¯”å¦‚è‡ªå®šä¹‰åŠ¨ç”»å¼•æ“æˆ–è€…è§†é¢‘æ’­æ”¾çš„æ¸²æŸ“ã€‚NSTimerçš„é€‚ç”¨èŒƒå›´ç›¸å¯¹å¹¿æ³›ã€‚<br><strong>éœ€è¦æ³¨æ„çš„æ˜¯iOSè®¾å¤‡çš„åˆ·æ–°é¢‘ç‡æ˜¯60HZï¼Œä¹Ÿå°±æ˜¯æ¯ç§’60æ¬¡ã€‚é‚£ä¹ˆæ¯ä¸€æ¬¡åˆ·æ–°æ—¶é—´å¤§çº¦16.7æ¯«ç§’ã€‚å½“æˆ‘ä»¬çš„<em>frameInterval</em>çš„å€¼ä¸º1çš„æ—¶å€™æˆ‘ä»¬éœ€è¦ä¿è¯CADisplayLinkè°ƒç”¨çš„targetçš„å‡½æ•°è®¡ç®—æ—¶é—´ä¸åº”è¯¥å¤§äº16.7å¦åˆ™ä¼šå‡ºç°ä¸¥é‡çš„ä¸¢å¸§ç°è±¡</strong></p>
<h2 id="GCD-Source"><a href="#GCD-Source" class="headerlink" title="GCD Source"></a>GCD Source</h2><h4 id="dispatch-after"><a href="#dispatch-after" class="headerlink" title="dispatch_after"></a>dispatch_after</h4><p>ä¸ºäº†é¿å…NSTimerå¯èƒ½å­˜åœ¨çš„é£é™©ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©ä½¿ç”¨dispatch_afterï¼Œä½¿ç”¨gcdæ—¶ç³»ç»Ÿä¼šå¸®æˆ‘ä»¬å¤„ç†çº¿ç¨‹çº§çš„é€»è¾‘ï¼›é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬ä¹Ÿä¸éœ€è¦è€ƒè™‘RunLoopçš„é—®é¢˜ï¼Œè¿™æ ·è°ƒç”¨å¯¹è±¡ä¹Ÿä¸ä¼šè¢«æŒæœ‰ï¼Œä¸Šè¿°å…³äºå†…å­˜æ³„æ¼ä¹Ÿä¸å­˜åœ¨äº†ã€‚å½“ç„¶ï¼Œéœ€è¦æ³¨æ„blockå¯èƒ½å¯¼è‡´çš„å¾ªç¯å¼•ç”¨é—®é¢˜ã€‚<br><strong>ä½†æ˜¯dispatch_afterä¹Ÿæœ‰ä¸€ä¸ªå¾ˆä¸¥é‡çš„é—®é¢˜ï¼Œé‚£å°±æ˜¯ä¸€æ—¦æ‰§è¡Œåå°±ä¸èƒ½æ’¤é”€äº†ï¼ï¼ï¼</strong></p>
<h4 id="dispatch-source"><a href="#dispatch-source" class="headerlink" title="dispatch_source"></a>dispatch_source</h4><p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥ç”¨GCDæœ¬èº«çš„timeråŠŸèƒ½<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT,0);</span><br><span class="line">dispatch_source_t tiemr = dispatch_source_create(DISPATCH_SOURCE_TYPE_TIMER,0,0,queue);</span><br><span class="line">dispatch_source_set_timer(timer,DISPATCH_TIME_NOW,2.0 * NSEC_PER_SEC,0.1 * NSEC_PER_SEC);</span><br><span class="line">__weak typeof(self) weakSelf = self;</span><br><span class="line">dispatch_source_set_event_handler(timer,&lt;&#123;</span><br><span class="line">    [weakSelf action];</span><br><span class="line">&#125;);</span><br><span class="line">dispatch_resume(timer);</span><br><span class="line"></span><br><span class="line">disaptch_source_cancel(timer);</span><br></pre></td></tr></table></figure></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











  
    <article id="post-WKWebViewä¸jsçš„äº¤äº’" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a  href="/2015/10/20/WKWebViewä¸jsçš„äº¤äº’/" class="article-date">
      <time datetime="2015-10-19T16:00:00.000Z" itemprop="datePublished">2015-10-20</time>
</a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a  class="article-title" href="/2015/10/20/WKWebViewä¸jsçš„äº¤äº’/">WKWebViewä¸jsäº¤äº’</a>
    </h1>
  


      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h3 id="WKWebviewä¸UIWebViewçš„å¯¹æ¯”"><a href="#WKWebviewä¸UIWebViewçš„å¯¹æ¯”" class="headerlink" title="WKWebviewä¸UIWebViewçš„å¯¹æ¯”"></a>WKWebviewä¸UIWebViewçš„å¯¹æ¯”</h3><p>UIWebViewè‡ªiOS2å¼€å§‹å°±æœ‰äº†ï¼Œè€ŒWKWebViewåœ¨iOS8ä»¥ä¸Šçš„è®¾å¤‡ä¸Šæ‰å¯ä»¥ä½¿ç”¨ï¼Œæ¯«æ— ç–‘é—®WKWebViewå°†é€æ­¥å–ä»£ç›¸å¯¹ç¬¨é‡çš„UIWebViewã€‚<br>WkWebçš„ä¼˜åŠ¿ï¼š</p>
<ul>
<li>åœ¨æ€§èƒ½ã€ç¨³å®šæ€§ã€åŠŸèƒ½æ–¹é¢æœ‰å¾ˆå¤šå¤§æå‡</li>
<li>æ›´å¤šçš„æ”¯æŒHTML5çš„ç‰¹æ€§</li>
<li>å®˜å®£é«˜è¾¾60fpsçš„æ»šåŠ¨åˆ·æ–°ç‡ä»¥åŠå†…ç½®æ‰‹åŠ¿</li>
<li>Safariç›¸åŒçš„JavaScriptå¼•æ“</li>
<li>æ–°å¢åŠ è½½è¿›åº¦å±æ€§ç­‰ </li>
</ul>
<h4 id="åŠ è½½ç½‘é¡µ"><a href="#åŠ è½½ç½‘é¡µ" class="headerlink" title="åŠ è½½ç½‘é¡µ"></a>åŠ è½½ç½‘é¡µ</h4><p>åŠ è½½ç½‘é¡µæˆ–HTMLä»£ç æ–¹å¼ä¸UIWebViewç›¸åŒ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">WKWebView *webView = [[WKWebView alloc] initWithFrame:self.view.frame];</span><br><span class="line">[webView loadRequest:[NSURLRequest requestWithURL:[NSURL URLWithString:@&quot;www.zeuszhang.com&quot;]]];</span><br><span class="line">[self.view addSubView:webView];</span><br></pre></td></tr></table></figure></p>
<h4 id="åŠ è½½å›è°ƒçŠ¶æ€"><a href="#åŠ è½½å›è°ƒçŠ¶æ€" class="headerlink" title="åŠ è½½å›è°ƒçŠ¶æ€"></a>åŠ è½½å›è°ƒçŠ¶æ€</h4><p>åŠ è½½å›è°ƒçŠ¶æ€ç”¨æ¥è¿½è¸ªæ•´ä¸ªå®¶åœ¨è¿‡ç¨‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// é¡µé¢å¼€å§‹åŠ è½½æ—¶è°ƒç”¨</span><br><span class="line">- (void)webView:(WKWebView *)webView didStartProvisionalNavigation:(WKNavigation *)navigation;</span><br><span class="line">// å½“å†…å®¹å¼€å§‹è¿”å›æ—¶è°ƒç”¨</span><br><span class="line">- (void)webView:(WKWebView *)webView didCommitNavigation:(WKNavigation *)navigation;</span><br><span class="line">// é¡µé¢åŠ è½½å®Œæˆä¹‹åè°ƒç”¨</span><br><span class="line">- (void)webView:(WKWebView *)webView didFinishNavigation:(WKNavigation *)navigation;</span><br><span class="line">// é¡µé¢åŠ è½½å¤±è´¥æ—¶è°ƒç”¨</span><br><span class="line">- (void)webView:(WKWebView *)webView didFailProvisionalNavigation:(WKNavigation *)navigation</span><br></pre></td></tr></table></figure></p>
<p>é¡µé¢è·³è½¬çš„ä»£ç†æ–¹æ³•<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// æ¥æ”¶åˆ°æœåŠ¡å™¨è·³è½¬è¯·æ±‚ä¹‹åè°ƒç”¨</span><br><span class="line">- (void)webView:(WKWebView *)webView didReceiveServerRedirectForProvisionalNavigation:(WKNavigation *)navigation;</span><br><span class="line">// åœ¨æ”¶åˆ°å“åº”åï¼Œå†³å®šæ˜¯å¦è·³è½¬</span><br><span class="line">- (void)webView:(WKWebView *)webView decidePolicyForNavigationResponse:(WKNavigationResponse *)navigationResponse decisionHandler:(void (^)(WKNavigationResponsePolicy))decisionHandler;</span><br><span class="line">// åœ¨å‘é€è¯·æ±‚ä¹‹å‰ï¼Œå†³å®šæ˜¯å¦è·³è½¬</span><br><span class="line">- (void)webView:(WKWebView *)webView decidePolicyForNavigationAction:(WKNavigationAction</span><br></pre></td></tr></table></figure></p>
<p>æ–°çš„WKUIDelegateåè®®<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//è­¦å‘Šæ¡†</span><br><span class="line">- (void)webView:(WKWebView *)webView runJavaScriptAlertPanelWithMessage:(NSString *)message initiatedByFrame:(void (^)())completionHandler;</span><br><span class="line">//ç¡®è®¤æ¡†</span><br><span class="line">- (void)webView:(WKWebView *)webView runJavaScriptConfirmPanelWithMessage:(NSString *)message initiatedByFrame:(WKFrameInfo *)frame completionHandler:(void (^)(BOOL))completionHandler;</span><br><span class="line">//è¾“å…¥æ¡†</span><br><span class="line">- (void)webView:(WKWebView *)webView runJavaScriptTextInputPanelWithPrompt:(NSString *)prompt defaultText:(NSString *)defaultText initiatedByFrame:(WKFrameInfo *)frame completionHandler:(void (^)(NSString * _Nullable))completionHandler;</span><br></pre></td></tr></table></figure></p>
<p><strong><em>æ³¨æ„è¿™å‡ ä¸ªæ–¹æ³•çš„å›è°ƒå¤„ç†ä¸è®©å›crash</em></strong></p>
<h4 id="åŠ¨æ€åŠ è½½å¹¶è¿è¡Œjsä»£ç "><a href="#åŠ¨æ€åŠ è½½å¹¶è¿è¡Œjsä»£ç " class="headerlink" title="åŠ¨æ€åŠ è½½å¹¶è¿è¡Œjsä»£ç "></a>åŠ¨æ€åŠ è½½å¹¶è¿è¡Œjsä»£ç </h4><p>å®¢æˆ·ç«¯å†…éƒ¨åŠ è½½<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// å›¾ç‰‡ç¼©æ”¾çš„jsä»£ç </span><br><span class="line">NSString *js = @&quot;var count = document.images.length;for (var i = 0; i &lt; count; i++) &#123;var image = document.images[i];image.style.width=320;&#125;;window.alert(&apos;æ‰¾åˆ°&apos; + count + &apos;å¼ å›¾&apos;);&quot;;</span><br><span class="line">// æ ¹æ®JSå­—ç¬¦ä¸²åˆå§‹åŒ–WKUserScriptå¯¹è±¡</span><br><span class="line">WKUserScript *script = [[WKUserScript alloc] initWithSource:js injectionTime:WKUserScriptInjectionTimeAtDocumentEnd forMainFrameOnly:YES];</span><br><span class="line">// æ ¹æ®ç”Ÿæˆçš„WKUserScriptå¯¹è±¡ï¼Œåˆå§‹åŒ–WKWebViewConfiguration</span><br><span class="line">WKWebViewConfiguration *config = [[WKWebViewConfiguration alloc] init];</span><br><span class="line">[config.userContentController addUserScript:script];</span><br><span class="line">_webView = [[WKWebView alloc] initWithFrame:self.view.bounds configuration:config];</span><br><span class="line">[_webView loadHTMLString:@&quot;&lt;head&gt;&lt;/head&gt;&lt;imgea src=&apos;http://www.nsu.edu.cn/v/2014v3/img/background/3.jpg&apos; /&gt;&quot;baseURL:nil];</span><br><span class="line">[self.view addSubview:_webView];</span><br></pre></td></tr></table></figure></p>
<p>webviewæ‰§è¡Œjsä»£ç <br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//javaScriptStringæ˜¯JSæ–¹æ³•åï¼ŒcompletionHandleræ˜¯å¼‚æ­¥å›è°ƒblock</span><br><span class="line">[self.webView evaluateJavaScript:javaScriptString completionHandler:completionHandler];</span><br></pre></td></tr></table></figure></p>
<p>jsè°ƒç”¨appæ³¨å†Œçš„æ–¹æ³•<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (void)addScriptMessageHandler:(id &lt;WKScriptMessageHandler&gt;)scriptMessageHandler name:(NSString *)name;</span><br><span class="line">scriptMessageHandleræ˜¯ä»£ç†å›è°ƒï¼ŒJSè°ƒç”¨nameæ–¹æ³•åï¼ŒOCä¼šè°ƒç”¨scriptMessageHandleræŒ‡å®šçš„å¯¹è±¡ã€‚JSåœ¨è°ƒç”¨OCæ³¨å†Œæ–¹æ³•çš„æ—¶å€™è¦ç”¨ä¸‹é¢çš„æ–¹å¼ï¼š</span><br><span class="line">window.webkit.messageHandlers.&lt;name&gt;.postMessage(&lt;messageBody&gt;)</span><br></pre></td></tr></table></figure></p>
<p><strong><em>æ³¨æ„nameæ˜¯æ–¹æ³•åï¼Œå‚æ•°éœ€è¦å°è£…åˆ°messageBodyä¸­</em></strong></p>
<p><strong><em>psè¿™é‡Œæœ‰ä¸€ä¸ªé‡ç‚¹éœ€è¦æ³¨æ„çš„åœ°æ–¹</em></strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//OCæ³¨å†Œä¾›JSè°ƒç”¨çš„æ–¹æ³•</span><br><span class="line">[[_webView configuration].userContentController addScriptMessageHandler:self name:@&quot;closeMe&quot;];</span><br><span class="line">//OCåœ¨JSè°ƒç”¨æ–¹æ³•åšçš„å¤„ç†</span><br><span class="line">- (void)userContentController:(WKUserContentController *)userContentController didReceiveScriptMessage:(WKScriptMessage *)message</span><br><span class="line">&#123;</span><br><span class="line">    NSLog(@&quot;JS è°ƒç”¨äº† %@ æ–¹æ³•ï¼Œä¼ å›å‚æ•° %@&quot;,message.name,message.body);</span><br><span class="line">&#125;</span><br><span class="line">//JSè°ƒç”¨</span><br><span class="line">    window.webkit.messageHandlers.closeMe.postMessage(null);</span><br></pre></td></tr></table></figure></p>
<p>åœ¨ä¸Šè¿°å®¢æˆ·ç«¯ä¸­å¤„ç†æ—¶ï¼Œä¼šå‘ç°selfçš„deallocæ–¹æ³•æ²¡æœ‰è°ƒç”¨ï¼Œæˆ‘åœ¨è¿™é‡Œçš„è§£å†³æ–¹æ¡ˆæ˜¯åœ¨å½“å‰vcé”€æ¯æ—¶ï¼Œæ‰‹åŠ¨è°ƒç”¨<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[self.wkWebView.configuration.userContentController addScriptMessageHandler:self name:@&quot;&quot;];</span><br></pre></td></tr></table></figure></p>
<p>ä»¥ç§»é™¤é€šçŸ¥çš„ç›‘å¬æ–¹å¼ã€‚</p>
<p><strong><em>pps WKWebViewConfigurationä¹Ÿå­˜åœ¨å†…å­˜æ³„æ¼é—®é¢˜</em></strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">WKWebViewConfiguration*config = [[WKWebViewConfigurationalloc]init];</span><br><span class="line">config.selectionGranularity = WKSelectionGranularityCharacter;</span><br><span class="line">WKWebView Â *webView= [[WKWebViewalloc]initWithFrame:CGRectZero configuration:config];</span><br></pre></td></tr></table></figure></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











  
  

</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                &copy; 2019 ZeusZhang
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank">Hexo &nbsp;&nbsp;</a><a href="https://github.com/maochunguang" target="_blank">Blog</a> by tommy
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" >æå®¢åˆ°è®¿æ•°: 
                            <span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>, </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit">æœ¬é¡µé˜…è¯»é‡: 
                            <span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>

    </div>
    
<script src="https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>

<script src="/js/main.js"></script>

    <script>
        $(document).ready(function() {
            var backgroundnum = 1;
            var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
            $("#mobile-nav").css({"background-image": backgroundimg,"background-size": "cover","background-position": "center"});
            $(".left-col").css({"background-image": backgroundimg,"background-size": "cover","background-position": "center"});
        })
    </script>


<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'xxxxx', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->



	<script>
	var _hmt = _hmt || [];
	(function() {
	  var hm = document.createElement("script");
	  hm.src = "//hm.baidu.com/hm.js?xxxxxx";
	  var s = document.getElementsByTagName("script")[0]; 
	  s.parentNode.insertBefore(hm, s);
	})();
	</script>



<div class="scroll" id="scroll">
    <a href="#"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments"><i class="fa fa-comments-o"></i></a>
    <a href="#footer"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    $(document).ready(function() {
        if ($("#comments").length < 1) {
            $("#scroll > a:nth-child(2)").hide();
        };
    })
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

  <script language="javascript">
    $(function() {
        $("a[title]").each(function() {
            var a = $(this);
            var title = a.attr('title');
            if (title == undefined || title == "") return;
            a.data('title', title).removeAttr('title').hover(
            function() {
                var offset = a.offset();
                $("<div id=\"anchortitlecontainer\"></div>").appendTo($("body")).html(title).css({
                    top: offset.top - a.outerHeight() - 15,
                    left: offset.left + a.outerWidth()/2 + 1
                }).fadeIn(function() {
                    var pop = $(this);
                    setTimeout(function() {
                        pop.remove();
                    }, pop.text().length * 800);
                });
            }, function() {
                $("#anchortitlecontainer").remove();
            });
        });
    });
</script>


  </div>
</body>
</html>